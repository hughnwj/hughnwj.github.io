<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="1. 面向目标架构1.1 面向目标开发流程 大模型的核心目标是 自动规划、自动调用外部工具、自动生成外部函数，实现智能化执行任务。开发过程中，主要包含以下阶段：  大模型自动规划 大模型自动调用外部工具执行 大模型自动生成外部函数  1.2 技术选型1.2.1 提示词工程与外部函数 提示词工程  设计清晰、逻辑严谨的 Prompt，引导大模型按目标输出。   Function Call  让大模型">
<meta property="og:type" content="article">
<meta property="og:title" content="4.Agent实战基础之提示词工程和Function进阶实战">
<meta property="og:url" content="http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/index.html">
<meta property="og:site_name" content="cozy">
<meta property="og:description" content="1. 面向目标架构1.1 面向目标开发流程 大模型的核心目标是 自动规划、自动调用外部工具、自动生成外部函数，实现智能化执行任务。开发过程中，主要包含以下阶段：  大模型自动规划 大模型自动调用外部工具执行 大模型自动生成外部函数  1.2 技术选型1.2.1 提示词工程与外部函数 提示词工程  设计清晰、逻辑严谨的 Prompt，引导大模型按目标输出。   Function Call  让大模型">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/image-20250318093723927.png">
<meta property="og:image" content="http://example.com/images/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/image-20250319112047791.png">
<meta property="og:image" content="http://example.com/images/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/image-20250319112109227.png">
<meta property="og:image" content="http://example.com/images/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/image-20250319112123288.png">
<meta property="article:published_time" content="2025-03-17T03:51:42.283Z">
<meta property="article:modified_time" content="2025-03-22T16:08:15.581Z">
<meta property="article:author" content="cozy">
<meta property="article:tag" content="工作">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/image-20250318093723927.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>4.Agent实战基础之提示词工程和Function进阶实战</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/hughnwj">项目</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2025/03/21/5.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%A4%9A%E6%A8%A1%E6%80%81%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AE%9E%E6%88%98/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2025/03/16/3.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%9C%A8%E7%BA%BF%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BC%80%E5%8F%91/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&text=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&is_video=false&description=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=4.Agent实战基础之提示词工程和Function进阶实战&body=Check out this article: http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&name=4.Agent实战基础之提示词工程和Function进阶实战&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&t=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%9D%A2%E5%90%91%E7%9B%AE%E6%A0%87%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">1. 面向目标架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E9%9D%A2%E5%90%91%E7%9B%AE%E6%A0%87%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 面向目标开发流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 技术选型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E4%B8%8E%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 提示词工程与外部函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-AGENT-%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 AGENT 设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-RAG-%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 RAG 设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-%E5%BE%AE%E8%B0%83-Fine-tuning"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 微调 (Fine-tuning)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-%E9%A2%84%E8%AE%AD%E7%BB%83-Pre-training"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5 预训练 (Pre-training)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Function-Call-%E8%BF%9B%E9%98%B6"><span class="toc-number">2.</span> <span class="toc-text">2. Function Call 进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B%E5%9B%9E%E9%A1%BE"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 外部函数调用流程回顾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%9B%9B%E5%A4%A7%E6%8C%91%E6%88%98"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 四大挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%84%8F%E5%9B%BE%E8%AF%86%E5%88%AB"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 意图识别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-1-%E8%AF%AF%E5%88%A4%EF%BC%9A%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">2.2.1.1 误判：是否需要外部函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-2-%E8%AF%AF%E9%80%89%EF%BC%9A%E7%9B%B8%E4%BC%BC%E5%87%BD%E6%95%B0%E5%90%8D%E7%A7%B0%E6%B7%B7%E6%B7%86"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">2.2.1.2 误选：相似函数名称混淆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-3-%E7%BB%93%E6%9E%9C%E6%95%B4%E5%90%88%E5%A4%B1%E8%B4%A5%EF%BC%88%E5%8D%B3%E4%BD%BF%E8%B0%83%E7%94%A8%E6%88%90%E5%8A%9F%EF%BC%8C%E7%BB%93%E6%9E%9C%E4%BB%8D%E7%84%B6%E6%9C%89%E8%AF%AF%EF%BC%89"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">2.2.1.3 结果整合失败（即使调用成功，结果仍然有误）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%B5%B7%E9%87%8F%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 海量函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-1-%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">2.2.2.1 优化策略</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E5%B9%B6%E5%8F%91%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 并发调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-1-%E4%B8%B2%E8%A1%8C%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">2.2.3.1 串行调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-2-%E5%B9%B6%E8%A1%8C%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">2.2.3.2 并行调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-%E5%93%8D%E5%BA%94%E5%A4%AA%E6%85%A2"><span class="toc-number">2.2.4.</span> <span class="toc-text">2.2.4 响应太慢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-1-%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">2.2.4.1 缓存设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-2-%E5%8A%A8%E6%80%81%E8%B0%83%E6%95%B4%E8%B0%83%E7%94%A8%E9%80%BB%E8%BE%91"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">2.2.4.2 动态调整调用逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-3-%E5%BB%B6%E8%BF%9F%E5%8F%8D%E9%A6%88"><span class="toc-number">2.2.4.3.</span> <span class="toc-text">2.2.4.3 延迟反馈</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E9%9D%A2%E5%90%91%E7%9B%AE%E6%A0%87%E6%9E%B6%E6%9E%84%E9%98%B6%E6%AE%B5"><span class="toc-number">3.</span> <span class="toc-text">3. 面向目标架构阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BB%A5%E4%BA%BA%E4%B8%BA%E4%B8%BB%EF%BC%8CAI%E4%B8%BA%E8%BE%85"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 以人为主，AI为辅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A1%88%E4%BE%8B%EF%BC%9A"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 提示词案例：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Al%E5%92%8C%E4%BA%BA%E7%9B%B8%E4%BA%92%E9%85%8D%E5%90%88"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Al和人相互配合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%80%9F%E5%8A%A9Few-Shot"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 借助Few-Shot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E5%80%9F%E5%8A%A9LtM"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 借助LtM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3%E5%85%A8%E8%87%AA%E5%8A%A8%E5%8A%9F%E8%83%BD%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3全自动功能函数编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-1-%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%AE%A1%E7%90%86"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">3.2.3.1 提示词管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-2-code-generate%E5%85%A8%E8%87%AA%E5%8A%A8%E7%BC%96%E7%A8%8B%E5%87%BD%E6%95%B0%E5%88%9B%E5%BB%BA%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">3.2.3.2 code_generate全自动编程函数创建方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-3-%E9%A2%9D%E5%A4%96%E9%9C%80%E6%B1%82%E6%B5%8B%E8%AF%95"><span class="toc-number">3.2.3.3.</span> <span class="toc-text">3.2.3.3 额外需求测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Al%E4%B8%BA%E4%B8%BB%EF%BC%8C%E4%BB%A5%E4%BA%BA%E4%B8%BA%E8%BE%85"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Al为主，以人为辅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E5%AE%A1%E6%9F%A5%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%96%B9%E6%A1%88%E5%89%96%E6%9E%90"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 审查模型构建方案剖析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E5%AE%A1%E6%9F%A5%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%96%B9%E6%A1%88%E8%90%BD%E5%9C%B0"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 审查模型构建方案落地</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E5%AE%A1%E6%9F%A5%E6%A8%A1%E5%9E%8B%E6%95%88%E6%9E%9C%E9%AA%8C%E8%AF%81"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3 审查模型效果验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-4-%E5%9F%BA%E4%BA%8E%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%87%AA%E5%8A%A8Debug%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.4.</span> <span class="toc-text">3.3.4 基于大模型的自动Debug的函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-1-%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%AE%A1%E6%9F%A5%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">3.3.4.1 定义一个审查函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-2-%E6%9E%84%E5%BB%BA%E8%87%AA%E5%8A%A8Debug%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">3.3.4.2 构建自动Debug的函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-3-%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%81%E7%A8%8B%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99"><span class="toc-number">3.3.4.3.</span> <span class="toc-text">3.2.4.3 全自动流程代码编写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%BC%96%E7%A8%8B%E7%9A%84%E7%93%B6%E9%A2%88"><span class="toc-number">3.3.5.</span> <span class="toc-text">3.2.5 大模型编程的瓶颈</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-1-%E7%BC%96%E7%A8%8B%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E7%9A%84%E6%A0%B9%E6%BA%90"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">3.2.5.1 编程性能瓶颈的根源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-2-%E6%8F%90%E5%8D%87%E9%95%BF%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E7%A8%B3%E5%AE%9A%E6%80%A7%E7%9A%84%E7%AD%96%E7%95%A5"><span class="toc-number">3.3.5.2.</span> <span class="toc-text">3.2.5.2 提升长代码编写稳定性的策略</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-6%E5%A4%8D%E6%9D%82%E4%BB%BB%E5%8A%A1%E7%9A%84%E7%BC%96%E7%A8%8B%E8%90%BD%E5%9C%B0"><span class="toc-number">3.3.6.</span> <span class="toc-text">3.2.6复杂任务的编程落地</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-6-1-%E5%A4%8D%E6%9D%82%E9%9C%80%E6%B1%82%E6%8B%86%E8%A7%A3"><span class="toc-number">3.3.6.1.</span> <span class="toc-text">3.2.6.1 复杂需求拆解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-6-2-%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E4%B8%8E%E6%95%B4%E5%90%88"><span class="toc-number">3.3.6.2.</span> <span class="toc-text">3.2.6.2 代码编写与整合</span></a></li></ol></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        4.Agent实战基础之提示词工程和Function进阶实战
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">cozy</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-03-17T03:51:42.283Z" class="dt-published" itemprop="datePublished">2025-03-17</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/AI%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BC%80%E5%8F%91%E5%B7%A5%E7%A8%8B%E5%B8%88/">AI大模型开发工程师</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E5%B7%A5%E4%BD%9C/" rel="tag">工作</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="1-面向目标架构"><a href="#1-面向目标架构" class="headerlink" title="1. 面向目标架构"></a>1. 面向目标架构</h1><h2 id="1-1-面向目标开发流程"><a href="#1-1-面向目标开发流程" class="headerlink" title="1.1 面向目标开发流程"></a>1.1 面向目标开发流程</h2><p><img src="/images/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/image-20250318093723927.png" alt="image-20250318093723927"></p>
<p>大模型的核心目标是 自动规划、自动调用外部工具、自动生成外部函数，实现智能化执行任务。开发过程中，主要包含以下阶段：</p>
<ol>
<li>大模型自动规划</li>
<li>大模型自动调用外部工具执行</li>
<li>大模型自动生成外部函数</li>
</ol>
<h2 id="1-2-技术选型"><a href="#1-2-技术选型" class="headerlink" title="1.2 技术选型"></a>1.2 技术选型</h2><h3 id="1-2-1-提示词工程与外部函数"><a href="#1-2-1-提示词工程与外部函数" class="headerlink" title="1.2.1 提示词工程与外部函数"></a>1.2.1 提示词工程与外部函数</h3><ol>
<li><p>提示词工程</p>
<ul>
<li>设计清晰、逻辑严谨的 Prompt，引导大模型按目标输出。</li>
</ul>
</li>
<li><p>Function Call</p>
<ul>
<li>让大模型在对话过程中调用外部函数，完成复杂数据处理、查询、计算等任务。</li>
</ul>
</li>
<li><p>GLM-4模型</p>
<ul>
<li><p>特点：中上等模型，性能优异，中文理解能力强。</p>
</li>
<li><p>安装方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install zhipuai</span><br></pre></td></tr></table></figure>
</li>
<li><p>接口调用示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> zhipuai <span class="keyword">import</span> ZhipuAI</span><br><span class="line"></span><br><span class="line">client = ZhipuAI(api_key=<span class="string">&quot;your_api_key&quot;</span>)</span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">    model=<span class="string">&quot;glm-4&quot;</span>,</span><br><span class="line">    messages=[&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;请帮我分析这组数据&quot;</span>&#125;]</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(response.choices[<span class="number">0</span>].message.content)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>LangChain开发框架</p>
<ul>
<li><p>特点：提供多种大模型功能封装，包括记忆、代理、工具调用、RAG等能力。</p>
</li>
<li><p>安装方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install langchain</span><br></pre></td></tr></table></figure>
</li>
<li><p>示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chat_models <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">llm = ChatOpenAI(temperature=<span class="number">0.7</span>)</span><br><span class="line">result = llm.predict(<span class="string">&quot;如何实现自动化数据分析?&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="1-2-2-AGENT-设计"><a href="#1-2-2-AGENT-设计" class="headerlink" title="1.2.2 AGENT 设计"></a>1.2.2 AGENT 设计</h3><p>Agent 是自主执行任务的智能体，具备以下能力：</p>
<ul>
<li>目标规划：根据用户需求拆解任务，规划执行路径。</li>
<li>环境感知：根据外部输入调整行为。</li>
<li>工具调用：动态调用外部工具或函数，完成子任务。</li>
<li>自主决策：根据上下文和执行结果调整行动策略。</li>
</ul>
<h3 id="1-2-3-RAG-设计"><a href="#1-2-3-RAG-设计" class="headerlink" title="1.2.3 RAG 设计"></a>1.2.3 RAG 设计</h3><p>RAG (Retrieval-Augmented Generation)是一种结合检索与生成的方法，提升模型对事实性、知识性的回答能力。</p>
<ul>
<li>检索 (Retrieval)：从外部数据库、文档、API等来源查找相关信息。</li>
<li>生成 (Generation)：在检索到的信息基础上生成高质量回答。</li>
</ul>
<h3 id="1-2-4-微调-Fine-tuning"><a href="#1-2-4-微调-Fine-tuning" class="headerlink" title="1.2.4 微调 (Fine-tuning)"></a>1.2.4 微调 (Fine-tuning)</h3><p>微调是针对特定任务优化大模型，让它在指定场景表现更优。</p>
<ul>
<li>数据准备：收集领域数据，格式化成训练样本。</li>
<li>训练执行：用目标任务数据对模型继续训练。</li>
<li>性能评估：测试微调后的模型表现，确保提升效果。</li>
</ul>
<h3 id="1-2-5-预训练-Pre-training"><a href="#1-2-5-预训练-Pre-training" class="headerlink" title="1.2.5 预训练 (Pre-training)"></a>1.2.5 预训练 (Pre-training)</h3><p>预训练是大规模数据训练阶段，让模型具备基础语言理解、推理、知识存储能力。</p>
<ul>
<li>大规模文本训练（新闻、百科、论文、对话数据等）</li>
<li>多任务训练（翻译、问答、摘要、对话、代码理解等）</li>
<li>跨模态训练（图文理解、图生文、文生图等）</li>
</ul>
<h1 id="2-Function-Call-进阶"><a href="#2-Function-Call-进阶" class="headerlink" title="2. Function Call 进阶"></a>2. Function Call 进阶</h1><h2 id="2-1-外部函数调用流程回顾"><a href="#2-1-外部函数调用流程回顾" class="headerlink" title="2.1 外部函数调用流程回顾"></a>2.1 外部函数调用流程回顾</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> zhipuai <span class="keyword">import</span> ZhipuAI</span><br><span class="line"></span><br><span class="line">api_key = <span class="string">&quot;your_api_key&quot;</span></span><br><span class="line"></span><br><span class="line">client = ZhipuAI(api_key=api_key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例函数 - 孙悟空算法</span></span><br><span class="line"><span class="comment"># 该函数用于接收一个数据表（字符串形式），对数据进行处理并返回JSON格式结果</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sunwukong_function</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    孙悟空算法函数，该函数定义了数据集计算过程</span></span><br><span class="line"><span class="string">    :param data: 必要参数，表示带入计算的数据表，用字符串进行表示</span></span><br><span class="line"><span class="string">    :return: sunwukong_function函数计算后的结果，返回结果为JSON格式的Dataframe类型对象</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    data = io.StringIO(data)</span><br><span class="line">    df_new = pd.read_csv(data, sep=<span class="string">&#x27;\s+&#x27;</span>, index_col=<span class="number">0</span>)</span><br><span class="line">    res = df_new[<span class="string">&#x27;x1&#x27;</span>] * <span class="number">10</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps(res.to_string())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个示例数据集</span></span><br><span class="line"></span><br><span class="line">df_str = pd.DataFrame(&#123;<span class="string">&#x27;x1&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>], <span class="string">&#x27;x2&#x27;</span>: [<span class="number">3</span>, <span class="number">4</span>]&#125;).to_string</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个完整的对话流程</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_conversation</span>():</span><br><span class="line">    <span class="comment"># Step 1: 初始化对话，发送数据集和函数信息</span></span><br><span class="line">    messages = [</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;数据集data：%s，数据集以字符串形式呈现&quot;</span> % df_str&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;请在数据集data上执行孙悟空算法&quot;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义工具（函数）</span></span><br><span class="line">    tools = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">            <span class="string">&quot;function&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;sunwukong_function&quot;</span>,</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;用于执行孙悟空算法函数，定义了一种特殊的数据集计算过程&quot;</span>,</span><br><span class="line">                <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;data&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;执行孙悟空算法的数据集&quot;</span>&#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;data&quot;</span>]</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 2: 发送初次请求</span></span><br><span class="line">    response = client.chat.completions.create(</span><br><span class="line">        model=<span class="string">&quot;glm-4&quot;</span>,</span><br><span class="line">        messages=messages,</span><br><span class="line">        tools=tools,</span><br><span class="line">        tool_choice=<span class="string">&quot;auto&quot;</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取模型返回的消息</span></span><br><span class="line">    response_message = response.choices[<span class="number">0</span>].message</span><br><span class="line">    tool_calls = response_message.tool_calls</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 3: 判断模型是否要调用函数</span></span><br><span class="line">    <span class="keyword">if</span> tool_calls:</span><br><span class="line">        available_functions = &#123;<span class="string">&quot;sunwukong_function&quot;</span>: sunwukong_function&#125;  <span class="comment"># 这里可以扩展多种函数</span></span><br><span class="line">        messages.append(response_message.model_dump())  <span class="comment"># 将模型返回结果加入消息列表</span></span><br><span class="line">        <span class="built_in">print</span>(messages)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Step 4: 执行函数，并将返回结果传回模型</span></span><br><span class="line">        <span class="keyword">for</span> tool_call <span class="keyword">in</span> tool_calls:</span><br><span class="line">            function_name = tool_call.function.name</span><br><span class="line">            function_to_call = available_functions[function_name]</span><br><span class="line">            function_args = json.loads(tool_call.function.arguments)</span><br><span class="line">            function_response = function_to_call(**function_args)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 将函数结果传回对话上下文</span></span><br><span class="line">            messages.append(&#123;</span><br><span class="line">                <span class="string">&quot;tool_call_id&quot;</span>: tool_call.<span class="built_in">id</span>,</span><br><span class="line">                <span class="string">&quot;role&quot;</span>: <span class="string">&quot;tool&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: function_name,</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: function_response,</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Step 5: 发送最终请求，获取完整回答</span></span><br><span class="line">        second_response = client.chat.completions.create(</span><br><span class="line">            model=<span class="string">&quot;glm-4&quot;</span>,</span><br><span class="line">            messages=messages,</span><br><span class="line">            tools=tools,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> second_response</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行对话流程并输出最终结果</span></span><br><span class="line">result = run_conversation()</span><br><span class="line"><span class="built_in">print</span>(result.choices[<span class="number">0</span>].message.content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用StringIO将字符串转换为文件对象</span></span><br><span class="line"></span><br><span class="line">df_str = <span class="string">&#x27;\n    x1\n0  10\n1  20\n.&#x27;</span></span><br><span class="line">data = io.StringIO(df_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用read_csv()函数读取数据，并设置第一列为索引</span></span><br><span class="line"></span><br><span class="line">df_new = pd.read_csv(data, sep=<span class="string">&#x27;\s+&#x27;</span>, index_col=<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(df_new)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>OpenAI 与ZhipuAI 的区别</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>OpenAI 版本</th>
<th>ZhipuAI 版本</th>
</tr>
</thead>
<tbody><tr>
<td>第一轮请求</td>
<td>✅ 需要 <code>tools</code></td>
<td>✅ 需要 <code>tools</code></td>
</tr>
<tr>
<td>第二轮请求</td>
<td>❌ 不带 <code>tools</code></td>
<td>✅ 继续带 <code>tools</code></td>
</tr>
<tr>
<td>消息追加方式</td>
<td>直接追加</td>
<td><code>model_dump()</code> 转字典</td>
</tr>
</tbody></table>
</blockquote>
<h2 id="2-2-四大挑战"><a href="#2-2-四大挑战" class="headerlink" title="2.2 四大挑战"></a>2.2 四大挑战</h2><h3 id="2-2-1-意图识别"><a href="#2-2-1-意图识别" class="headerlink" title="2.2.1 意图识别"></a>2.2.1 意图识别</h3><h4 id="2-2-1-1-误判：是否需要外部函数"><a href="#2-2-1-1-误判：是否需要外部函数" class="headerlink" title="2.2.1.1 误判：是否需要外部函数"></a>2.2.1.1 误判：是否需要外部函数</h4><p>策略1：提供高质量的 JSON Schema</p>
<ol>
<li>关键词引导<br> 大模型（如 GLM-4）可能依赖 embedding 相似度选择函数，因此：<ul>
<li>在 prompt 中嵌入与函数名称高度一致的关键词，提高命中率。</li>
<li>设置独特的关键词（编号、专有名词等），避免与其他函数混淆。</li>
</ul>
</li>
<li>函数分类标记<br> 在函数名称或描述中增加分类前缀，如 user_、admin_、data_ 等，帮助模型快速定位类别。</li>
<li>权重提示<br> 对常用函数增加权重提示词，如 primary、core、重要、核心业务 等。</li>
<li>否定句筛选<br> 在函数描述中增加否定提示，例如“当出现 XXX 语言时，此函数无效”，帮助模型避开不合适的函数。</li>
</ol>
<h4 id="2-2-1-2-误选：相似函数名称混淆"><a href="#2-2-1-2-误选：相似函数名称混淆" class="headerlink" title="2.2.1.2 误选：相似函数名称混淆"></a>2.2.1.2 误选：相似函数名称混淆</h4><p>策略2：干预模型选择</p>
<ol>
<li>自查 Prompt<br> 在用户提问前，增加“XXX 是否在你的资料库内”的预检 prompt，确认模型是否掌握该知识。</li>
<li>关键词匹配优先<ul>
<li>建立业务关键词库，检测到关键词时强制指定 tool_choice 调用特定函数。</li>
<li>示例场景：用户说“我要点餐”、“我要吃饭”、“服务员过来一下”，均指向 点餐 函数。</li>
</ul>
</li>
</ol>
<h4 id="2-2-1-3-结果整合失败（即使调用成功，结果仍然有误）"><a href="#2-2-1-3-结果整合失败（即使调用成功，结果仍然有误）" class="headerlink" title="2.2.1.3 结果整合失败（即使调用成功，结果仍然有误）"></a>2.2.1.3 结果整合失败（即使调用成功，结果仍然有误）</h4><p>策略3：优化消息传递格式</p>
<ol>
<li><p>旧版方法缺陷<br> 使用 tool 角色传递函数名与结果，但实验显示模型无法有效识别上下文。</p>
</li>
<li><p>新版优化方案</p>
<ul>
<li><p>改用 assistant 角色传递函数结果，配合额外提示确保模型理解返回结果的来源。</p>
</li>
<li><p>示例代码调整：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message.append(&#123;</span><br><span class="line">    <span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>,</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: <span class="string">&quot;你使用了 tools 工具，最终获得的答案是&quot;</span> + <span class="built_in">str</span>(function_response),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>调用校验</p>
<ul>
<li><p>增加“是否成功调用了函数”的检测逻辑，防止模型误判：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response_f.choices[<span class="number">0</span>].message.tool_calls[<span class="number">0</span>].function.name</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n被调用的函数是&#123;&#125;&quot;</span>.<span class="built_in">format</span>(response_f.choices[<span class="number">0</span>].message.tool_calls[<span class="number">0</span>].function.name))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n没有函数被成功调用！&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="2-2-2-海量函数"><a href="#2-2-2-海量函数" class="headerlink" title="2.2.2 海量函数"></a>2.2.2 海量函数</h3><ol>
<li>Token 限制问题</li>
<li>计算延迟问题</li>
<li>意图识别困难</li>
</ol>
<h4 id="2-2-2-1-优化策略"><a href="#2-2-2-1-优化策略" class="headerlink" title="2.2.2.1 优化策略"></a>2.2.2.1 优化策略</h4><ol>
<li><p>分层架构指导函数分割<br> 在复杂场景下按层次划分函数库：</p>
<ul>
<li>表示层（用户交互逻辑）：注册、登录、更新信息等。</li>
<li>业务逻辑层（核心功能）：订单管理、商品管理等。</li>
<li>数据访问层（数据库交互）：数据存取、查询等。</li>
<li>服务层（内部&#x2F;外部接口）：API 服务、第三方集成等。</li>
</ul>
<p>层级筛选流程：先通过高层次意图识别选择层级 → 再在层内精细筛选函数。</p>
</li>
<li><p>关键词分割<br> 在 JSON Schema 中引入关键词，如“章节”、“年级”等，先粗略划分函数集合。</p>
</li>
<li><p>结合向量数据库 + RAG（检索增强生成）技术</p>
<ul>
<li>预处理：将函数描述向量化，存储到向量数据库。</li>
<li>用户意图向量化：用户输入也进行向量化，进行语义匹配。</li>
<li>动态加载相关函数：从搜索结果中动态筛选可能相关的函数，再进一步调用。</li>
</ul>
</li>
</ol>
<h3 id="2-2-3-并发调用"><a href="#2-2-3-并发调用" class="headerlink" title="2.2.3 并发调用"></a>2.2.3 并发调用</h3><h4 id="2-2-3-1-串行调用"><a href="#2-2-3-1-串行调用" class="headerlink" title="2.2.3.1 串行调用"></a>2.2.3.1 串行调用</h4><ul>
<li>按照特定顺序执行多个函数，保持上下文连贯性。</li>
</ul>
<h4 id="2-2-3-2-并行调用"><a href="#2-2-3-2-并行调用" class="headerlink" title="2.2.3.2 并行调用"></a>2.2.3.2 并行调用</h4><ul>
<li>支持同时调用多个函数，汇总结果后统一返回。</li>
</ul>
<h3 id="2-2-4-响应太慢"><a href="#2-2-4-响应太慢" class="headerlink" title="2.2.4 响应太慢"></a>2.2.4 响应太慢</h3><h4 id="2-2-4-1-缓存设计"><a href="#2-2-4-1-缓存设计" class="headerlink" title="2.2.4.1 缓存设计"></a>2.2.4.1 缓存设计</h4><ul>
<li>针对特定场景（如高频查询、静态数据）设计缓存机制，减少重复调用。</li>
</ul>
<h4 id="2-2-4-2-动态调整调用逻辑"><a href="#2-2-4-2-动态调整调用逻辑" class="headerlink" title="2.2.4.2 动态调整调用逻辑"></a>2.2.4.2 动态调整调用逻辑</h4><ul>
<li>按需调整串行&#x2F;并行策略，确保关键函数优先执行。</li>
</ul>
<h4 id="2-2-4-3-延迟反馈"><a href="#2-2-4-3-延迟反馈" class="headerlink" title="2.2.4.3 延迟反馈"></a>2.2.4.3 延迟反馈</h4><ul>
<li>对时间敏感场景，先返回部分结果，再补充完整信息。</li>
</ul>
<h1 id="3-面向目标架构阶段"><a href="#3-面向目标架构阶段" class="headerlink" title="3. 面向目标架构阶段"></a>3. 面向目标架构阶段</h1><h2 id="3-1-以人为主，AI为辅"><a href="#3-1-以人为主，AI为辅" class="headerlink" title="3.1 以人为主，AI为辅"></a>3.1 以人为主，AI为辅</h2><p><img src="/images/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/image-20250319112047791.png" alt="image-20250319112047791"></p>
<ol>
<li><p>人梳理需求</p>
</li>
<li><p>大模型帮忙写代码</p>
</li>
<li><p>人审核代码</p>
</li>
</ol>
<h3 id="3-1-1-提示词案例："><a href="#3-1-1-提示词案例：" class="headerlink" title="3.1.1 提示词案例："></a>3.1.1 提示词案例：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/root/autodl-tmp/面向目标架构落地/data/my_mail数据字典.md&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    md_content = f.read()</span><br><span class="line">    </span><br><span class="line">user_example_content = <span class="string">&quot;请帮我编写一个python函数，用于查看我的mailbox邮箱中最后一封邮件信息，函数要求如下：\</span></span><br><span class="line"><span class="string">                        1.函数参数userId，userId是字符串参数，默认情况下取值为&#x27;me&#x27;，表示查看我的邮件；\</span></span><br><span class="line"><span class="string">                        2.函数返回结果是一个包含最后一封邮件信息的对象，返回结果本身必须是一个json格式对象；\</span></span><br><span class="line"><span class="string">                        3.请将全部功能封装在一个函数内；\</span></span><br><span class="line"><span class="string">                        4.请在函数编写过程中，在函数内部加入中文编写的详细的函数说明文档，用于说明函数功能、函数参数情况以及函数返回结果等信息；&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;%s.py&#x27;</span> % <span class="string">&#x27;code/get_latest_email&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    assistant_example_content = f.read()</span><br><span class="line"></span><br><span class="line">user_content = <span class="string">&quot;请帮我编写一个python函数，用于查看我的mailbox邮箱中总共有多少封邮件，函数要求如下：\</span></span><br><span class="line"><span class="string">                1.函数参数userId，userId是字符串参数，默认情况下取值为&#x27;me&#x27;，表示查看我的邮件；\</span></span><br><span class="line"><span class="string">                2.函数返回结果是当前邮件总数，返回结果本身必须是一个json格式对象；\</span></span><br><span class="line"><span class="string">                3.请将全部功能封装在一个函数内；\</span></span><br><span class="line"><span class="string">                4.请在函数编写过程中，在函数内部加入中文编写的详细的函数说明文档，用于说明函数功能、函数参数情况以及函数返回结果等信息；&quot;</span></span><br><span class="line"></span><br><span class="line">messages=[&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: md_content&#125;,</span><br><span class="line">          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example_user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_example_content&#125;,</span><br><span class="line">          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example_assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: assistant_example_content&#125;,</span><br><span class="line">          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example_user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_content&#125;]</span><br></pre></td></tr></table></figure>

<h2 id="3-2-Al和人相互配合"><a href="#3-2-Al和人相互配合" class="headerlink" title="3.2 Al和人相互配合"></a>3.2 Al和人相互配合</h2><p><img src="/images/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/image-20250319112109227.png" alt="image-20250319112109227"></p>
<ol>
<li><p>大模型梳理需求</p>
</li>
<li><p>大模型帮忙写代码</p>
</li>
<li><p>人审核代码</p>
</li>
</ol>
<h3 id="3-2-1-借助Few-Shot"><a href="#3-2-1-借助Few-Shot" class="headerlink" title="3.2.1 借助Few-Shot"></a>3.2.1 借助Few-Shot</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">get_email_input = <span class="string">&quot;请帮我查下邮箱里最后一封邮件内容。&quot;</span></span><br><span class="line"></span><br><span class="line">get_email_out = <span class="string">&quot;请帮我编写一个python函数，用于查看我的mailbox邮箱中最后一封邮件信息，函数要求如下：\</span></span><br><span class="line"><span class="string">                 1.函数参数userId，userId是字符串参数，默认情况下取值为&#x27;me&#x27;，表示查看我的邮件；\</span></span><br><span class="line"><span class="string">                 2.函数返回结果是一个包含最后一封邮件信息的对象，返回结果本身必须是一个json格式对象；\</span></span><br><span class="line"><span class="string">                 3.请将全部功能封装在一个函数内；\</span></span><br><span class="line"><span class="string">                 4.请在函数编写过程中，在函数内部加入中文编写的详细的函数说明文档，用于说明函数功能、函数参数情况以及函数返回结果等信息；&quot;</span></span><br><span class="line"></span><br><span class="line">email_counts_input = <span class="string">&quot;请帮我查下邮箱里现在总共有多少封邮件。&quot;</span></span><br><span class="line"></span><br><span class="line">email_counts_out = <span class="string">&quot;请帮我编写一个python函数，用于查看我的mailbox邮箱中总共有多少封邮件，函数要求如下：\</span></span><br><span class="line"><span class="string">                    1.函数参数userId，userId是字符串参数，默认情况下取值为&#x27;me&#x27;，表示查看我的邮件；\</span></span><br><span class="line"><span class="string">                    2.函数返回结果是当前邮件总数，返回结果本身必须是一个json格式对象；\</span></span><br><span class="line"><span class="string">                    3.请将全部功能封装在一个函数内；\</span></span><br><span class="line"><span class="string">                    4.请在函数编写过程中，在函数内部加入中文编写的详细的函数说明文档，用于说明函数功能、函数参数情况以及函数返回结果等信息；&quot;</span></span><br><span class="line"></span><br><span class="line">user_content = <span class="string">&quot;请查下我的邮箱里是否有来陆小凤的未读邮件，并解读最近一封未读邮件的内容&quot;</span></span><br><span class="line"><span class="comment"># &#123;&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: md_content&#125;,</span></span><br><span class="line"><span class="comment"># one-shot  few-shot</span></span><br><span class="line"></span><br><span class="line">messages_fewShot_stage1 = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">f&quot;最后输出的是一个说明，举个例子，输出格式如下：<span class="subst">&#123;email_counts_out&#125;</span>&quot;</span>&#125;,</span><br><span class="line">                           &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;请模仿下列对话给出的风格，基于我的问题，把我的问题转换成一个说明。注意：不需要有额外输出&quot;</span>&#125;,</span><br><span class="line">                          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example1_user&quot;</span>, <span class="string">&quot;content&quot;</span>: get_email_input&#125;,</span><br><span class="line">                          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example1_assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: get_email_out&#125;,</span><br><span class="line">                          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example2_user&quot;</span>, <span class="string">&quot;content&quot;</span>: email_counts_input&#125;,</span><br><span class="line">                          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example2_assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: email_counts_out&#125;,</span><br><span class="line">                          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example_user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_content&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-借助LtM"><a href="#3-2-2-借助LtM" class="headerlink" title="3.2.2 借助LtM"></a>3.2.2 借助LtM</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">system_content1 = <span class="string">&quot;为了更好编写满足用户需求的python函数，我们需要先识别用户需求中的变量，以作为python函数的参数。需要注意的是，当前编写的函数中涉及到的邮件收发查阅等功能，都是通过Python来完成。&quot;</span></span><br><span class="line"></span><br><span class="line">input1 = <span class="string">&quot;请帮我查下mailbox邮箱里最后一封邮件内容。&quot;</span></span><br><span class="line"></span><br><span class="line">pi1 = <span class="string">&quot;当前需求中可以作为函数参数的是：1.查看谁的邮箱。&quot;</span></span><br><span class="line"></span><br><span class="line">input2 = <span class="string">&quot;请帮我给西门吹雪发送一封邮件，请他明天早上9点半来我办公室开会，商量下半年技术开发计划。&quot;</span></span><br><span class="line"></span><br><span class="line">pi2 = <span class="string">&quot;当前需求中可以作为函数参数的是：1.发送邮件的对象；2.发送邮件的主题；3.邮件具体内容&quot;</span></span><br><span class="line"></span><br><span class="line">input3 = <span class="string">&quot;请查下我的邮箱里是否有来自陆小凤的未读邮件，并解读最近一封未读邮件的内容。&quot;</span></span><br><span class="line"></span><br><span class="line">messages_CD = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: system_content1&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example1_user&quot;</span>, <span class="string">&quot;content&quot;</span>: input1&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example1_assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: pi1&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example2_user&quot;</span>, <span class="string">&quot;content&quot;</span>: input2&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example2_assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: pi2&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;example_user&quot;</span>, <span class="string">&quot;content&quot;</span>: input3&#125;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>​	如果在Few-shot的提示下，第一阶段的指令翻译不是每一次都能给出令人满意的结果，首先我们想到的解决问题的办法就是提供一些更加强有力的提示方法：例如LtM提示法。</p>
<p>​	根据LtM多段提示的策略，外加结合当前指令翻译任务考虑，一种更有希望能够引导模型能够顺利完成指令翻译流程的提示方法是：先引导模型拆解当前需求中的“变量”作为后续函数的参数，然后再基于已经确定的变量，引导模型完成翻译工作。 </p>
<p>​	其实就整个指令翻译任务来说，最难的地方也就在于函数参数的理解过程，而一旦模型能够准确的翻译出外部函数需要哪些参数，其他部分的翻译任务自然迎刃而解。</p>
</blockquote>
<h3 id="3-2-3全自动功能函数编程"><a href="#3-2-3全自动功能函数编程" class="headerlink" title="3.2.3全自动功能函数编程"></a>3.2.3全自动功能函数编程</h3><h4 id="3-2-3-1-提示词管理"><a href="#3-2-3-1-提示词管理" class="headerlink" title="3.2.3.1 提示词管理"></a>3.2.3.1 提示词管理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一阶段LtM_CD阶段提示词及输出结果</span></span><br><span class="line">get_latest_email_CD_input = <span class="string">&quot;请帮我查下mailbox邮箱里最新一封邮件内容。&quot;</span></span><br><span class="line">get_latest_email_pi = <span class="string">&quot;当前需求中可以作为函数参数的是：1.查看谁的邮箱。&quot;</span></span><br><span class="line">get_latest_email_messages_CD = [</span><br><span class="line">                                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: get_latest_email_CD_input&#125;,</span><br><span class="line">                                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: get_latest_email_pi&#125;</span><br><span class="line">                                ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一阶段LtM_CM阶段提示词及输出结果</span></span><br><span class="line">get_latest_email_CM_input = get_latest_email_CD_input + get_latest_email_pi</span><br><span class="line">get_latest_email_description = <span class="string">&quot;请帮我编写一个python函数，用于查看我的mailbox邮箱中最后一封邮件信息，函数要求如下：\</span></span><br><span class="line"><span class="string">                 1.函数参数userId，userId是字符串参数，默认情况下取值为&#x27;me&#x27;，表示查看我的邮件；\</span></span><br><span class="line"><span class="string">                 2.函数返回结果是一个包含最后一封邮件信息的对象，返回结果本身必须是一个json格式对象；\</span></span><br><span class="line"><span class="string">                 3.请将全部功能封装在一个函数内；\</span></span><br><span class="line"><span class="string">                 4.请在函数编写过程中，在函数内部加入中文编写的详细的函数说明文档，用于说明函数功能、函数参数情况以及函数返回结果等信息；&quot;</span></span><br><span class="line">get_latest_email_messages_CM = [</span><br><span class="line">                                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: get_latest_email_CM_input&#125;,</span><br><span class="line">                                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>:get_latest_email_description&#125;</span><br><span class="line">                                ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二阶段提示词及输出结果</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/%s/%s_module.py&#x27;</span> % (<span class="string">&#x27;get_latest_email&#x27;</span>, <span class="string">&#x27;get_latest_email&#x27;</span>), encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    get_latest_email_function = f.read()</span><br><span class="line">get_latest_email_messages = [</span><br><span class="line">                             &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: get_latest_email_description&#125;,</span><br><span class="line">                             &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>:get_latest_email_function&#125;</span><br><span class="line">                             ]  </span><br><span class="line"></span><br><span class="line">get_latest_email_prompt = &#123;</span><br><span class="line">                            <span class="string">&quot;stage1_CD&quot;</span>: get_latest_email_messages_CD,</span><br><span class="line">                            <span class="string">&quot;stage1_CM&quot;</span>: get_latest_email_messages_CM,</span><br><span class="line">                            <span class="string">&quot;stage2&quot;</span>: get_latest_email_messages</span><br><span class="line">                          &#125;   </span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/%s/%s_prompt.json&#x27;</span> % (<span class="string">&#x27;get_latest_email&#x27;</span>,<span class="string">&#x27;get_latest_email&#x27;</span>), <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(get_latest_email_prompt, f)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们当前提示流程中各阶段的系统提示消息，也需要对其进行整理和本地保存：</span></span><br><span class="line"></span><br><span class="line">system_messages = &#123;<span class="string">&quot;system_message_CD&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: md_content&#125;], </span><br><span class="line">                   <span class="string">&quot;system_message_CM&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>:md_content &#125;], </span><br><span class="line">                   <span class="string">&quot;system_message&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>:md_content&#125;]&#125;</span><br><span class="line">               </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/%s.json&#x27;</span> % <span class="string">&#x27;system_messages&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(system_messages, f)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义提示词管理的辅助函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_to_tested</span>(<span class="params">function_name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将函数同名文件夹由untested文件夹转移至tested文件夹内。\</span></span><br><span class="line"><span class="string">    完成转移则说明函数通过测试，可以使用。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将函数代码写入glmLesson.py文件中</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_module.py&#x27;</span> % (function_name, function_name), encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        function_code = f.read()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 源文件夹路径</span></span><br><span class="line">    src_dir = <span class="string">&#x27;./functions/untested functions/%s&#x27;</span> % function_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 目标文件夹路径</span></span><br><span class="line">    dst_dir = <span class="string">&#x27;./functions/tested functions/%s&#x27;</span> % function_name</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 移动文件夹</span></span><br><span class="line">    shutil.move(src_dir, dst_dir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_function_code</span>(<span class="params">s, detail=<span class="number">0</span>, tested=<span class="literal">False</span>, g=<span class="built_in">globals</span>(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    函数提取函数，同时执行函数内容，可以选择打印函数信息，并选择代码保存的地址</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_code</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        如果输入的字符串s是一个包含Python代码的Markdown格式字符串，提取出代码部分。</span></span><br><span class="line"><span class="string">        否则，返回原字符串。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">        s: 输入的字符串。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        返回:</span></span><br><span class="line"><span class="string">        提取出的代码部分，或原字符串。</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 判断字符串是否是Markdown格式</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;```python&#x27;</span> <span class="keyword">in</span> s <span class="keyword">or</span> <span class="string">&#x27;Python&#x27;</span> <span class="keyword">in</span> s <span class="keyword">or</span><span class="string">&#x27;PYTHON&#x27;</span> <span class="keyword">in</span> s:</span><br><span class="line">            <span class="comment"># 找到代码块的开始和结束位置</span></span><br><span class="line">            code_start = s.find(<span class="string">&#x27;def&#x27;</span>)</span><br><span class="line">            code_end = s.find(<span class="string">&#x27;```\n&#x27;</span>, code_start)</span><br><span class="line">            <span class="comment"># 提取代码部分</span></span><br><span class="line">            code = s[code_start:code_end]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果字符串不是Markdown格式，返回原字符串</span></span><br><span class="line">            code = s</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> code</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取代码字符串</span></span><br><span class="line">    code = extract_code(s)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取函数名称</span></span><br><span class="line">    <span class="keyword">match</span> = re.search(<span class="string">r&#x27;def (\w+)&#x27;</span>, code)</span><br><span class="line">    function_name = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 在untested文件夹内创建函数同名文件夹</span></span><br><span class="line">    directory = <span class="string">&#x27;./functions/untested functions/%s&#x27;</span> % function_name</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">        os.makedirs(directory)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将函数写入本地</span></span><br><span class="line">    <span class="keyword">if</span> tested == <span class="literal">False</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_module.py&#x27;</span> % (function_name, function_name), <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(code)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 调用remove_to_test函数将函数文件夹转移至tested文件夹内</span></span><br><span class="line">        remove_to_tested(function_name)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/%s/%s_module.py&#x27;</span> % (function_name, function_name), <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(code)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行该函数</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">exec</span>(code, g)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;An error occurred while executing the code:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打印函数名称</span></span><br><span class="line">    <span class="keyword">if</span> detail == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The function name is:%s&quot;</span> % function_name)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> detail == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> tested == <span class="literal">False</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_module.py&#x27;</span> % (function_name, function_name), <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                content = f.read()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/%s/%s_module.py&#x27;</span> % (function_name, function_name), <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:   </span><br><span class="line">                content = f.read()</span><br><span class="line">                </span><br><span class="line">        <span class="built_in">print</span>(content)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> function_name</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_functions</span>(<span class="params">tested=<span class="literal">False</span>, if_print=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    打印tested或untested文件夹内全部函数</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    current_directory = os.getcwd()</span><br><span class="line">    <span class="keyword">if</span> tested == <span class="literal">False</span>:</span><br><span class="line">        directory = current_directory + <span class="string">&#x27;/functions/untested functions&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        directory = current_directory + <span class="string">&#x27;/functions/tested functions&#x27;</span></span><br><span class="line">    files_and_directories = os.listdir(directory)</span><br><span class="line">    <span class="comment"># 过滤结果，只保留.py文件和非__pycache__文件夹</span></span><br><span class="line">    files_and_directories = files_and_directories = [name <span class="keyword">for</span> name <span class="keyword">in</span> files_and_directories <span class="keyword">if</span> (os.path.splitext(name)[<span class="number">1</span>] == <span class="string">&#x27;.py&#x27;</span> <span class="keyword">or</span> os.path.isdir(os.path.join(directory, name))) <span class="keyword">and</span> name != <span class="string">&quot;.ipynb_checkpoints&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> if_print != <span class="literal">False</span>:</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> files_and_directories:</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> files_and_directories</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-2-code-generate全自动编程函数创建方法"><a href="#3-2-3-2-code-generate全自动编程函数创建方法" class="headerlink" title="3.2.3.2 code_generate全自动编程函数创建方法"></a>3.2.3.2 code_generate全自动编程函数创建方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">code_generate</span>(<span class="params">req, few_shot=<span class="string">&#x27;all&#x27;</span>, model=<span class="string">&#x27;glm-4&#x27;</span>, g=<span class="built_in">globals</span>(<span class="params"></span>), detail=<span class="number">0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Function calling外部函数自动创建函数，可以根据用户的需求，直接将其翻译为Chat模型可以直接调用的外部函数代码。</span></span><br><span class="line"><span class="string">    :param req: 必要参数，字符串类型，表示输入的用户需求；</span></span><br><span class="line"><span class="string">    :param few_shot: 可选参数，默认取值为字符串all，用于描述Few-shot提示示例的选取方案，当输入字符串all时，则代表提取当前外部函数库中全部测试过的函数作为Few-shot；\</span></span><br><span class="line"><span class="string">    而如果输入的是一个包含了多个函数名称的list，则表示使用这些函数作为Few-shot。</span></span><br><span class="line"><span class="string">    :param model: 可选参数，表示调用的Chat模型，默认选取glm-4；</span></span><br><span class="line"><span class="string">    :param g: 可选参数，表示extract_function_code函数作用域，默认为globals()，即在当前操作空间全域内生效；</span></span><br><span class="line"><span class="string">    :param detail: 可选参数，默认取值为0，还可以取值为1，表示extract_function_code函数打印新创建的外部函数细节；</span></span><br><span class="line"><span class="string">    :return：新创建的函数名称。需要注意的是，在函数创建时，该函数也会在当前操作空间被定义，后续可以直接调用；</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取提示示例的函数名称</span></span><br><span class="line">    <span class="keyword">if</span> few_shot == <span class="string">&#x27;all&#x27;</span>:</span><br><span class="line">        few_shot_functions_name = show_functions(tested=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(few_shot) == <span class="built_in">list</span>:</span><br><span class="line">        few_shot_functions_name = few_shot</span><br><span class="line">    <span class="comment"># few_shot_functions = [globals()[name] for name in few_shot_functions_name]</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 读取各阶段系统提示</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/system_messages.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        system_messages = json.load(f)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 各阶段提示message对象</span></span><br><span class="line">    few_shot_messages_CM = []</span><br><span class="line">    few_shot_messages_CD = []</span><br><span class="line">    </span><br><span class="line">    few_shot_messages = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 先保存第一条消息，也就是system message</span></span><br><span class="line">    few_shot_messages_CD += system_messages[<span class="string">&quot;system_message_CD&quot;</span>]</span><br><span class="line">    few_shot_messages_CM += system_messages[<span class="string">&quot;system_message_CM&quot;</span>]</span><br><span class="line">    few_shot_messages += system_messages[<span class="string">&quot;system_message&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建不同阶段提示message</span></span><br><span class="line">    <span class="keyword">for</span> function_name <span class="keyword">in</span> few_shot_functions_name:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/%s/%s_prompt.json&#x27;</span> % (function_name, function_name), <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            msg = json.load(f)</span><br><span class="line">        few_shot_messages_CD += msg[<span class="string">&quot;stage1_CD&quot;</span>]</span><br><span class="line">        few_shot_messages_CM += msg[<span class="string">&quot;stage1_CM&quot;</span>]</span><br><span class="line">        few_shot_messages += msg[<span class="string">&#x27;stage2&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 读取用户需求，作为第一阶段CD环节User content</span></span><br><span class="line">    new_req_CD_input = req</span><br><span class="line">    few_shot_messages_CD.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: new_req_CD_input&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;第一阶段CD环节提示创建完毕，正在进行CD提示...&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 第一阶段CD环节Chat模型调用过程</span></span><br><span class="line">    response = client.chat.completions.create(</span><br><span class="line">                        model=model,</span><br><span class="line">                        messages=few_shot_messages_CD)</span><br><span class="line">    new_req_pi = response.choices[<span class="number">0</span>].message.content</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;第一阶段CD环节提示完毕&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 第一阶段CM环节Messages创建</span></span><br><span class="line">    new_req_CM_input = new_req_CD_input + new_req_pi</span><br><span class="line">    few_shot_messages_CM.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: new_req_CM_input&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;第一阶段CM环节提示创建完毕，正在进行第一阶段CM提示...&#x27;</span>)</span><br><span class="line">    <span class="comment"># 第一阶段CM环节Chat模型调用过程</span></span><br><span class="line">    response = client.chat.completions.create(</span><br><span class="line">                        model=model,</span><br><span class="line">                        messages=few_shot_messages_CM)</span><br><span class="line">    new_req_description = response.choices[<span class="number">0</span>].message.content</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;第一阶段CM环节提示完毕&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 第二阶段Messages创建过程</span></span><br><span class="line">    few_shot_messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: new_req_description&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;第二阶段提示创建完毕，正在进行第二阶段提示...&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 第二阶段Chat模型调用过程</span></span><br><span class="line">    response = client.chat.completions.create(</span><br><span class="line">                        model=model,</span><br><span class="line">                        messages=few_shot_messages)</span><br><span class="line">    new_req_function = response.choices[<span class="number">0</span>].message.content</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;第二阶段提示完毕，准备运行函数并编写提示示例&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取函数并运行，创建函数名称对象，统一都写入untested文件夹内</span></span><br><span class="line">    function_name = extract_function_code(s=new_req_function, detail=detail, g=g)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;新函数保存在./functions/untested functions/%s/%s_module.py文件中&#x27;</span> % (function_name, function_name))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建该函数提示示例</span></span><br><span class="line">    new_req_messages_CD = [</span><br><span class="line">                          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: new_req_CD_input&#125;,</span><br><span class="line">                          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: new_req_pi&#125;</span><br><span class="line">                         ]</span><br><span class="line">    new_req_messages_CM = [</span><br><span class="line">                          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: new_req_CM_input&#125;,</span><br><span class="line">                          &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>:new_req_description&#125;</span><br><span class="line">                         ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_module.py&#x27;</span> % (function_name, function_name), encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        new_req_function = f.read()</span><br><span class="line">    </span><br><span class="line">    new_req_messages = [</span><br><span class="line">                       &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: new_req_description&#125;,</span><br><span class="line">                       &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>:new_req_function&#125;</span><br><span class="line">                      ] </span><br><span class="line">    </span><br><span class="line">    new_req_prompt = &#123;</span><br><span class="line">                     <span class="string">&quot;stage1_CD&quot;</span>: new_req_messages_CD,</span><br><span class="line">                     <span class="string">&quot;stage1_CM&quot;</span>: new_req_messages_CM,</span><br><span class="line">                     <span class="string">&quot;stage2&quot;</span>: new_req_messages</span><br><span class="line">                    &#125;   </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_prompt.json&#x27;</span> % (function_name, function_name), <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(new_req_prompt, f)</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;新函数提示示例保存在./functions/untested functions/%s/%s_prompt.json文件中&#x27;</span> % (function_name, function_name))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;done&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> function_name</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-3-额外需求测试"><a href="#3-2-3-3-额外需求测试" class="headerlink" title="3.2.3.3 额外需求测试"></a>3.2.3.3 额外需求测试</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">few_shot_functions = [<span class="string">&#x27;get_latest_email&#x27;</span>, <span class="string">&#x27;get_email_count&#x27;</span>]</span><br><span class="line">req = <span class="string">&quot;请查下邮箱里，me这个邮箱给陆小凤发过多少封邮件？&quot;</span></span><br><span class="line">function_name = code_generate(req=req, few_shot=few_shot_functions)</span><br><span class="line">functions_list = [function_name]</span><br><span class="line">messages = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;我的邮箱号叫me,陆小凤的邮箱号就叫陆小凤&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: req&#125;]</span><br><span class="line">final_response = run_conversation(messages=messages, functions_list=functions_list, model=<span class="string">&quot;glm-4&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(final_response)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-3-Al为主，以人为辅"><a href="#3-3-Al为主，以人为辅" class="headerlink" title="3.3 Al为主，以人为辅"></a>3.3 Al为主，以人为辅</h2><p><img src="/images/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/image-20250319112123288.png" alt="image-20250319112123288"></p>
<ol>
<li><p>大模型梳理需求</p>
</li>
<li><p>大模型帮忙写代码</p>
</li>
<li><p>大模型审核代码</p>
</li>
</ol>
<h3 id="3-3-1-审查模型构建方案剖析"><a href="#3-3-1-审查模型构建方案剖析" class="headerlink" title="3.3.1 审查模型构建方案剖析"></a>3.3.1 审查模型构建方案剖析</h3><ol>
<li>预训练，微调：这些方案需要的数据量很大，我们压根也没有那么多的样本的数据，而且这种方案门槛很高，成本也很高。所以不现实。</li>
<li>One-Shot，Few-Shot：这些方案在简单场景下有用，复杂场景就不管用了，而且如果我们Few-shot的量大的话，我们的上文的Token就不够用，所以这个方案也行不通。</li>
<li>外挂本地知识库：大模型本身能力就很强，而且懂的也很多，所以我们换个思路，我们搞一个本地知识库，在本地知识库里激发这个大模型的能力，从而引导这个大模型完成审查任务。</li>
<li>如何引导和启发一个大语言模型去理解一些陌生的事物？就像老师教学一样，有两个简单高效的方法，其一是是用其已知的知识去类比未知的知识，其二则是将陌生事物视为某些一般概念的特例。例如，当前的外部挂载文档非常重要的一个作用就是要让大语言模型理解现在要审查的多段提示，即要引导大语言模型理解什么是多段提示，但如果从头开始进行相关概念介绍（例如从头介绍两个阶段的提示分别是什么、什么是LtM、什么是问题拆解等）会非常的繁琐且效率很低，因此这里我们可以将多段提示比喻成推理链，借助大语言模型本身对推理链的理解来理解什么是多段提示。</li>
</ol>
<p>案例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function_name = <span class="string">&#x27;get_latest_email&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/%s/%s_prompt.json&#x27;</span> % (function_name, function_name), <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    msg = json.load(f)</span><br><span class="line">chain_of_prompt = <span class="string">&quot;以下是个一个成功运行的推理链条，推理分为三个阶段，各阶段推理内容如下：%s。&quot;</span> % msg</span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">                        model=<span class="string">&quot;glm-4&quot;</span>,</span><br><span class="line">                        messages=[&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,  <span class="string">&quot;content&quot;</span>: <span class="string">&quot;以下是一个推理链，用于创建一个满足某个功能的函数，推理链如下：%s。请帮我介绍下这个推理链&quot;</span> % chain_of_prompt&#125;]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.choices[<span class="number">0</span>].message.content)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-审查模型构建方案落地"><a href="#3-3-2-审查模型构建方案落地" class="headerlink" title="3.3.2 审查模型构建方案落地"></a>3.3.2 审查模型构建方案落地</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;复杂需求推理链.md&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    md_content = f.read()</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(md_content)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是邮箱项目？邮件项目本身由一系列的程序组成，核心功能是根据用户自然语言描述进行相应的邮箱操作，如查阅邮件、收发邮件等。该场景是我们自己构建的一个场景。主要实现的是对我们my_mail数据库里的数据进行增删查改。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>什么是推理链？在智能邮件项目中，推理链特指将用户的需求逐步推导为python函数的过程，也就是说，每个推理链的输入都是用户需求，而推理的结果则是一个可以满足用户需求的函数。每个推理链都有三个推理环节，且都以json格式表示，例如，以下是一个正确的推理链A：</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;<span class="string">&quot;stage1_CD&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;\u8bf7\u67e5\u9605\u6211\u90ae\u7bb1\u91cc\u9762\u672a\u8bfb\u90ae\u4ef6\uff0c\u4ece\u6311\u9009\u6709\u5173\u4f1a\u8bae\u9080\u8bf7\u7684\u90ae\u4ef6\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u4e00\u4e2a\u540d\u79f0\u4e3a\u4f1a\u8bae\u9884\u5b9a\u7684\u6807\u7b7e&quot;</span>&#125;, &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;\u5f53\u524d\u9700\u6c42\u4e2d\u53ef\u4ee5\u4f5c\u4e3a\u51fd\u6570\u53c2\u6570\u7684\u662f\uff1a1.\u67e5\u8be2\u6761\u4ef6\uff1b2.\u6dfb\u52a0\u7684\u6807\u7b7e\u540d\uff1b3.\u67e5\u8be2\u8c01\u7684\u90ae\u7bb1&quot;</span>&#125;], <span class="string">&quot;stage1_CM&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;\u8bf7\u67e5\u9605\u6211\u90ae\u7bb1\u91cc\u9762\u672a\u8bfb\u90ae\u4ef6\uff0c\u4ece\u6311\u9009\u6709\u5173\u4f1a\u8bae\u9080\u8bf7\u7684\u90ae\u4ef6\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u4e00\u4e2a\u540d\u79f0\u4e3a\u4f1a\u8bae\u9884\u5b9a\u7684\u6807\u7b7e\u5f53\u524d\u9700\u6c42\u4e2d\u53ef\u4ee5\u4f5c\u4e3a\u51fd\u6570\u53c2\u6570\u7684\u662f\uff1a1.\u67e5\u8be2\u6761\u4ef6\uff1b2.\u6dfb\u52a0\u7684\u6807\u7b7e\u540d\uff1b3.\u67e5\u8be2\u8c01\u7684\u90ae\u7bb1&quot;</span>&#125;, &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;\u8bf7\u5e2e\u6211\u7f16\u5199\u4e00\u4e2apython\u51fd\u6570\uff0c\u67e5\u8be2\u6211\u6536\u5230\u7684\u6240\u6709\u672a\u8bfb\u90ae\u4ef6\uff0c\u5e76\u5728\u4e0e\u4f1a\u8bae\u9080\u8bf7\u76f8\u5173\u7684\u90ae\u4ef6\u4e0a\u6dfb\u52a0\u4e00\u79cd\u540d\u4e3a\u201c\u4f1a\u8bae\u9884\u5b9a\u201d\u7684\u6807\u7b7e\uff0c\u51fd\u6570\u8981\u6c42\u5982\u4e0b\uff1a                  1.\u51fd\u6570\u53c2\u6570query\u3001tag\u548cuser_id\uff0c\u4e09\u4e2a\u53c2\u6570\u90fd\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u5176\u4e2dquery\u8868\u793a\u8981\u67e5\u8be2\u7684\u6761\u4ef6\uff0ctag\u8868\u793a\u8981\u6dfb\u52a0\u7684\u6807\u7b7e\u540d\uff0cuser_id\u8868\u793a\u8981\u68c0\u7d22\u90ae\u4ef6\u7684\u7528\u6237\u7684ID\u3002\u9ed8\u8ba4\u503c\u662f&#x27;me&#x27;\uff0c\u8868\u793a\u5f53\u524d\u6388\u6743\u7684\u7528\u6237\uff1b                  2.\u51fd\u6570\u8fd4\u56de\u7ed3\u679c\u662f\u6dfb\u52a0\u6807\u7b7e\u540e\u7684\u90ae\u4ef6\u5217\u8868\uff0c\u8fd4\u56de\u7ed3\u679c\u672c\u8eab\u5fc5\u987b\u662f\u4e00\u4e2ajson\u683c\u5f0f\u5bf9\u8c61\uff1b                  3.\u8bf7\u5c06\u5168\u90e8\u529f\u80fd\u5c01\u88c5\u5728\u4e00\u4e2a\u51fd\u6570\u5185\uff1b                  4.\u8bf7\u5728\u51fd\u6570\u7f16\u5199\u8fc7\u7a0b\u4e2d\uff0c\u5728\u51fd\u6570\u5185\u90e8\u52a0\u5165\u4e2d\u6587\u7f16\u5199\u7684\u8be6\u7ec6\u7684\u51fd\u6570\u8bf4\u660e\u6587\u6863\uff0c\u7528\u4e8e\u8bf4\u660e\u51fd\u6570\u529f\u80fd\u3001\u51fd\u6570\u53c2\u6570\u60c5\u51b5\u4ee5\u53ca\u51fd\u6570\u8fd4\u56de\u7ed3\u679c\u7b49\u4fe1\u606f\uff1b&quot;</span>&#125;], <span class="string">&quot;stage2&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;\u8bf7\u5e2e\u6211\u7f16\u5199\u4e00\u4e2apython\u51fd\u6570\uff0c\u67e5\u8be2\u6211\u6536\u5230\u7684\u6240\u6709\u672a\u8bfb\u90ae\u4ef6\uff0c\u5e76\u5728\u4e0e\u4f1a\u8bae\u9080\u8bf7\u76f8\u5173\u7684\u90ae\u4ef6\u4e0a\u6dfb\u52a0\u4e00\u79cd\u540d\u4e3a\u201c\u4f1a\u8bae\u9884\u5b9a\u201d\u7684\u6807\u7b7e\uff0c\u51fd\u6570\u8981\u6c42\u5982\u4e0b\uff1a                  1.\u51fd\u6570\u53c2\u6570query\u3001tag\u548cuser_id\uff0c\u4e09\u4e2a\u53c2\u6570\u90fd\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u5176\u4e2dquery\u8868\u793a\u8981\u67e5\u8be2\u7684\u6761\u4ef6\uff0ctag\u8868\u793a\u8981\u6dfb\u52a0\u7684\u6807\u7b7e\u540d\uff0cuser_id\u8868\u793a\u8981\u68c0\u7d22\u90ae\u4ef6\u7684\u7528\u6237\u7684ID\u3002\u9ed8\u8ba4\u503c\u662f&#x27;me&#x27;\uff0c\u8868\u793a\u5f53\u524d\u6388\u6743\u7684\u7528\u6237\uff1b                  2.\u51fd\u6570\u8fd4\u56de\u7ed3\u679c\u662f\u6dfb\u52a0\u6807\u7b7e\u540e\u7684\u90ae\u4ef6\u5217\u8868\uff0c\u8fd4\u56de\u7ed3\u679c\u672c\u8eab\u5fc5\u987b\u662f\u4e00\u4e2ajson\u683c\u5f0f\u5bf9\u8c61\uff1b                  3.\u8bf7\u5c06\u5168\u90e8\u529f\u80fd\u5c01\u88c5\u5728\u4e00\u4e2a\u51fd\u6570\u5185\uff1b                  4.\u8bf7\u5728\u51fd\u6570\u7f16\u5199\u8fc7\u7a0b\u4e2d\uff0c\u5728\u51fd\u6570\u5185\u90e8\u52a0\u5165\u4e2d\u6587\u7f16\u5199\u7684\u8be6\u7ec6\u7684\u51fd\u6570\u8bf4\u660e\u6587\u6863\uff0c\u7528\u4e8e\u8bf4\u660e\u51fd\u6570\u529f\u80fd\u3001\u51fd\u6570\u53c2\u6570\u60c5\u51b5\u4ee5\u53ca\u51fd\u6570\u8fd4\u56de\u7ed3\u679c\u7b49\u4fe1\u606f\uff1b&quot;</span>&#125;, &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;def label_meeting_emails(query, tag, user_id=&#x27;me&#x27;):\n    \&quot;\&quot;\&quot;\n    \u67e5\u8be2\u672a\u8bfb\u90ae\u4ef6\uff0c\u5e76\u7ed9\u4e0e\u4f1a\u8bae\u9080\u8bf7\u76f8\u5173\u7684\u90ae\u4ef6\u6dfb\u52a0\u6807\u7b7e\u3002\n\n    \u53c2\u6570:\n    query: \u8981\u67e5\u8be2\u7684\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5bfb\u627e\u5305\u542b\u201c\u4f1a\u8bae\u201d\u6216\u201c\u9080\u8bf7\u201d\u7b49\u5173\u952e\u5b57\u7684\u90ae\u4ef6\u3002\n    tag: \u8981\u6dfb\u52a0\u7684\u6807\u7b7e\u7684\u540d\u5b57\u3002\n    user_id: \u8981\u68c0\u67e5\u7684\u7528\u6237\u7684ID\uff0c\u9ed8\u8ba4\u503c\u4e3a&#x27;me&#x27;\uff0c\u8868\u793a\u5f53\u524d\u6388\u6743\u7684\u7528\u6237\u3002\n\n    \u8fd4\u56de:\n    \u5982\u679c\u6210\u529f\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u5217\u8868\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5305\u542b\u5df2\u6dfb\u52a0\u6807\u7b7e\u7684\u90ae\u4ef6\u7684ID\u548c\u4e3b\u9898\u3002\u5426\u5219\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u3002\n    \&quot;\&quot;\&quot;\n    # \u4ece\u672c\u5730\u6587\u4ef6\u4e2d\u52a0\u8f7d\u51ed\u636e\n    creds = Credentials.from_authorized_user_file(&#x27;token.json&#x27;)\n\n    # \u521b\u5efa Gmail API \u5ba2\u6237\u5bf9\u8c61\n    service = build(&#x27;gmail&#x27;, &#x27;v1&#x27;, credentials=creds)\n\n    # \u83b7\u53d6\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u90ae\u4ef6\u5217\u8868\n    results = service.users().messages().list(userId=user_id, q=f&#x27;is:unread &#123;query&#125;&#x27;).execute()\n    messages = results.get(&#x27;messages&#x27;, [])\n\n    if not messages:\n        print(f\&quot;No results for query: &#123;query&#125;\&quot;)\n        return json.dumps(&#123;\&quot;error\&quot;:\&quot;No emails found.\&quot;&#125;)\n\n    # \u4e3a\u6ee1\u8db3\u6761\u4ef6\u7684\u90ae\u4ef6\u6dfb\u52a0\u6807\u7b7e\n    emails = []\n    for msg in messages:\n        # \u83b7\u53d6\u90ae\u4ef6\u8be6\u60c5\n        msg = service.users().messages().get(userId=user_id, id=msg[&#x27;id&#x27;]).execute()\n\n        # \u6807\u7b7e\u5904\u7406\n        add_label = &#123;\n            &#x27;addLabelIds&#x27;: [tag],\n            &#x27;removeLabelIds&#x27;: []\n        &#125;\n        msg[&#x27;payload&#x27;][&#x27;headers&#x27;][-1].get(&#x27;value&#x27;)\n        res = service.users().messages().modify(userId=user_id, id=msg[&#x27;id&#x27;], body=add_label).execute()\n\n        # \u6dfb\u52a0\u90ae\u4ef6\u4fe1\u606f\n        for d in msg[&#x27;payload&#x27;][&#x27;headers&#x27;]:\n            if d[&#x27;name&#x27;] == &#x27;Subject&#x27;:\n                sub = d[&#x27;value&#x27;]\n        emails.append(&#123;\&quot;id\&quot;: res[&#x27;id&#x27;], \&quot;subject\&quot;: sub&#125;)\n\n    return json.dumps(emails, indent=2)\n&quot;</span>&#125;]&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>对于推理链最后生成的函数，一定要是可以运行的、能够满足用户需求的python函数，且需要有详细的说明文档，说明文档内容包括函数功能、函数参数情况以及函数返回结果等信息；</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>你是一个推理链审查助手，善于检测推理链中是否存在错误。接下来我会给你一个错误的推理链，请你对其进行修改；</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>当你对推理链进行修改之后，请仿造推理链A的格式，以json格式输出修改之后的推理链。注意，请勿返回其他解释说明的文字，只返回一个json格式的修改之后的推理链即可。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里我们可以简单总结外部挂载文档的5方面信息：</p>
<ol>
<li><p>说明当前项目背景（包括编程要求等）；</p>
</li>
<li><p>说明审查对象，包括审查对象的性质和形式等；</p>
</li>
<li><p>说明审查的目标；</p>
</li>
<li><p>进行身份设置；</p>
</li>
<li><p>说明审查之后的输出结果。</p>
</li>
</ol>
</blockquote>
<h3 id="3-3-3-审查模型效果验证"><a href="#3-3-3-审查模型效果验证" class="headerlink" title="3.3.3 审查模型效果验证"></a>3.3.3 审查模型效果验证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;复杂需求推理链.md&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    md_content = f.read()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./error_function_test/%s/%s_prompt.json&#x27;</span> % (function_name, function_name), <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    msg = json.load(f)</span><br><span class="line"></span><br><span class="line">msg_str = json.dumps(msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./data/my_mail数据字典.md&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data_content = f.read()</span><br><span class="line"></span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">                        model=<span class="string">&quot;glm-4&quot;</span>,</span><br><span class="line">                        messages=[</span><br><span class="line">                            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: data_content&#125;,</span><br><span class="line">                            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: md_content&#125;,</span><br><span class="line">                            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&#x27;以下是一个错误的邮箱项目的推理链，请你按照要求对其进行修改：%s&#x27;</span> % msg_str&#125;</span><br><span class="line">                          ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-4-基于大模型的自动Debug的函数"><a href="#3-3-4-基于大模型的自动Debug的函数" class="headerlink" title="3.3.4 基于大模型的自动Debug的函数"></a>3.3.4 基于大模型的自动Debug的函数</h3><h4 id="3-3-4-1-定义一个审查函数"><a href="#3-3-4-1-定义一个审查函数" class="headerlink" title="3.3.4.1 定义一个审查函数"></a>3.3.4.1 定义一个审查函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">prompt_modified</span>(<span class="params">function_name, system_content=<span class="string">&#x27;./data/推理链.md&#x27;</span>, model=<span class="string">&quot;glm-4&quot;</span>, g=<span class="built_in">globals</span>(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    邮箱项目的外部函数审查函数，用于审查外部函数创建流程提示是否正确以及最终创建的代码是否正确</span></span><br><span class="line"><span class="string">    :param function_name: 必要参数，字符串类型，表示审查对象名称；</span></span><br><span class="line"><span class="string">    :param system_content: 可选参数，默认取值为字符串推理链修改.md，表示此时审查函数外部挂载文档名称，需要是markdwon格式文档；</span></span><br><span class="line"><span class="string">    :param model: 可选参数，表示调用的Chat模型，默认选glm-4；</span></span><br><span class="line"><span class="string">    :param g: 可选参数，表示extract_function_code函数作用域，默认为globals()，即在当前操作空间全域内生效；</span></span><br><span class="line"><span class="string">    :return：审查结束后新创建的函数名称</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在执行审查函数，审查对象：%s&quot;</span> % function_name)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./data/my_mail数据字典.md&quot;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data_content = f.read()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(system_content, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        md_content = f.read()</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 读取原函数全部提示内容</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_prompt.json&#x27;</span> % (function_name, function_name), <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        msg = json.load(f)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将其保存为字符串</span></span><br><span class="line">    msg_str = json.dumps(msg)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 进行审查</span></span><br><span class="line">    response = client.chat.completions.create(</span><br><span class="line">                        model=model,</span><br><span class="line">                        messages=[</span><br><span class="line">                            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: data_content&#125;,</span><br><span class="line">                            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: md_content&#125;,</span><br><span class="line">                            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&#x27;以下是一个错误的邮箱项目的推理链，请你按照要求对其进行修改：%s&#x27;</span> % msg_str&#125;</span><br><span class="line">                          ]</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    modified_result = response.choices[<span class="number">0</span>].message.content</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_json</span>(<span class="params">s</span>):</span><br><span class="line">        pattern = <span class="string">r&#x27;```[jJ][sS][oO][nN]\s*(&#123;.*?&#125;)\s*```&#x27;</span></span><br><span class="line">        <span class="keyword">match</span> = re.search(pattern, s, re.DOTALL)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">    </span><br><span class="line">    modified_json = extract_json(modified_result)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取函数源码</span></span><br><span class="line">    code = json.loads(modified_json)[<span class="string">&#x27;stage2&#x27;</span>][<span class="number">1</span>][<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取函数名</span></span><br><span class="line">    <span class="keyword">match</span> = re.search(<span class="string">r&#x27;def (\w+)&#x27;</span>, code)</span><br><span class="line">    function_name = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;审查结束，新的函数名称为：%s。\n正在运行该函数定义过程，并保存函数源码与prompt&quot;</span> % function_name)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">exec</span>(code, g)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 在untested文件夹内创建函数同名文件夹</span></span><br><span class="line">    directory = <span class="string">&#x27;./functions/untested functions/%s&#x27;</span> % function_name</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">        os.makedirs(directory)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 写入函数</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_module.py&#x27;</span> % (function_name, function_name), <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(code)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 写入提示</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_prompt.json&#x27;</span> % (function_name, function_name), <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(json.loads(modified_json), f)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;新函数提示示例保存在./functions/untested functions/%s/%s_prompt.json文件中&#x27;</span> % (function_name, function_name))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;%s函数已在当前操作空间定义，可以进行效果测试&quot;</span> % function_name)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> function_name</span><br></pre></td></tr></table></figure>

<h4 id="3-3-4-2-构建自动Debug的函数"><a href="#3-3-4-2-构建自动Debug的函数" class="headerlink" title="3.3.4.2 构建自动Debug的函数"></a>3.3.4.2 构建自动Debug的函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">function_test</span>(<span class="params">function_name, req, few_shot, model=<span class="string">&quot;glm-4&quot;</span>, g=<span class="built_in">globals</span>(<span class="params"></span>)</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_messages</span>(<span class="params">ueser_content</span>):</span><br><span class="line">        messages = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: data_content&#125;,</span><br><span class="line">                     &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;我的邮箱号叫me&quot;</span>&#125;,</span><br><span class="line">                    &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: ueser_content&#125;]</span><br><span class="line">        <span class="keyword">return</span> messages</span><br><span class="line">            </span><br><span class="line">    messages = test_messages(req)</span><br><span class="line">    </span><br><span class="line">    new_function = <span class="built_in">globals</span>()[function_name]</span><br><span class="line">    functions_list = [new_function]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;根据既定用户需求req进行%s函数功能测试，请确保当该函数已经在当前操作空间定义...&quot;</span> % function_name)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 有可能在run_conversation环节报错</span></span><br><span class="line">    <span class="comment"># 若没报错，则运行：</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">## 直接调用看当前函数给出来的结果是否正确</span></span><br><span class="line">        <span class="comment">## 有两种可能：1，代码能运行 2. 代码不能运行</span></span><br><span class="line">        final_response = run_conversation(messages=messages, functions_list=functions_list, model=model)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;当前函数运行结果：&#x27;%s&#x27;&quot;</span> % final_response)</span><br><span class="line">        <span class="comment">## 如果代码能运行看一下是否能满足需求</span></span><br><span class="line">        feedback = <span class="built_in">input</span>(<span class="string">&quot;函数功能是否满足要求 (yes/no)? &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> feedback.lower() == <span class="string">&#x27;yes&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;函数功能通过测试，正在将函数写入tested文件夹&quot;</span>)</span><br><span class="line">            <span class="comment">## 如果满足就通过测试</span></span><br><span class="line">            remove_to_tested(function_name)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;done&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">## 如果不满足需求</span></span><br><span class="line">            next_step = <span class="built_in">input</span>(<span class="string">&quot;函数功能未通过测试，是1.需要再次进行测试，还是2.进入debug流程？&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> next_step == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;准备再次测试...&quot;</span>)</span><br><span class="line">                <span class="comment">## 再次运行</span></span><br><span class="line">                function_test(function_name, req, few_shot)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">## 进行Debug，选择方案</span></span><br><span class="line">                solution = <span class="built_in">input</span>(<span class="string">&quot;请选择debug方案：\n1.再次执行函数创建流程，并测试结果；\n2.执行审查函数\</span></span><br><span class="line"><span class="string">                \n3.重新输入用户需求；\n4.退出程序，进行手动尝试&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> solution == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                    <span class="comment"># 再次运行函数创建过程</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;好的，正在尝试再次创建函数，请稍等...&quot;</span>)</span><br><span class="line">                    few_shot_str = <span class="built_in">input</span>(<span class="string">&quot;准备再次测试，请问是1.采用此前Few-shot方案，还是2.带入全部函数示例进行Few-shot？&quot;</span>)</span><br><span class="line">                    <span class="keyword">if</span> few_shot_str == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                        function_name = code_generate(req=req, few_shot=few_shot, model=model, g=g)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        function_name = code_generate(req=req, few_shot=<span class="string">&#x27;all&#x27;</span>, model=model, g=g)</span><br><span class="line">                    <span class="comment">## 构建完了以后继续运行</span></span><br><span class="line">                    function_test(function_name=function_name, req=req, few_shot=few_shot, g=g)</span><br><span class="line">                <span class="keyword">elif</span> solution == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">                    <span class="comment"># 执行审查函数</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;好的，执行审查函数，请稍等...&quot;</span>)</span><br><span class="line">                    function_name = prompt_modified(function_name=function_name, model=<span class="string">&quot;gpt-3.5-turbo-16k-0613&quot;</span>, g=g)</span><br><span class="line">                    <span class="comment"># 接下来带入进行测试</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;新函数已创建，接下来带入进行测试...&quot;</span>)</span><br><span class="line">                    function_test(function_name=function_name, req=req, few_shot=few_shot, g=g)</span><br><span class="line">                <span class="keyword">elif</span> solution == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">                    <span class="comment">## 用户重新输入需求，也就意味着重新</span></span><br><span class="line">                    new_req = <span class="built_in">input</span>(<span class="string">&quot;好的，请再次输入用户需求，请注意，用户需求描述方法将极大程度影响最终函数创建结果。&quot;</span>)</span><br><span class="line">                    few_shot_str = <span class="built_in">input</span>(<span class="string">&quot;接下来如何运行代码创建函数？1.采用此前Few-shot方案；\n2.使用全部外部函数作为Few-shot&quot;</span>)</span><br><span class="line">                    <span class="keyword">if</span> few_shot_str == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                        function_name = code_generate(req=new_req, few_shot=few_shot, model=model, g=g)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        function_name = code_generate(req=new_req, few_shot=<span class="string">&#x27;all&#x27;</span>, model=model, g=g)</span><br><span class="line">                    function_test(function_name=function_name, req=new_req, few_shot=few_shot, g=g)</span><br><span class="line">                <span class="keyword">elif</span> solution == <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;加油~&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># run_conversation报错时则运行：</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        next_step = <span class="built_in">input</span>(<span class="string">&quot;run_conversation无法正常运行，接下来是1.再次运行运行run_conversation，还是2.进入debug流程？&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> next_step == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            function_test(function_name, req, few_shot)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            solution = <span class="built_in">input</span>(<span class="string">&quot;请选择debug方案：\n1.再次执行函数创建流程，并测试结果；\n2.执行审查函数\</span></span><br><span class="line"><span class="string">            \n3.重新输入用户需求；\n4.退出程序，进行手动尝试&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> solution == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="comment"># 再次运行函数创建过程</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;好的，正在尝试再次创建函数，请稍等...&quot;</span>)</span><br><span class="line">                few_shot_str = <span class="built_in">input</span>(<span class="string">&quot;准备再次测试，请问是1.采用此前Few-shot方案，还是2.带入全部函数示例进行Few-shot？&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> few_shot_str == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                    function_name = code_generate(req=req, few_shot=few_shot, model=model, g=g)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    function_name = code_generate(req=req, few_shot=<span class="string">&#x27;all&#x27;</span>, model=model, g=g)</span><br><span class="line">                function_test(function_name=function_name, req=req, few_shot=few_shot, g=g)</span><br><span class="line">            <span class="keyword">elif</span> solution == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">                <span class="comment"># 执行审查函数</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;好的，执行审查函数，请稍等...&quot;</span>)</span><br><span class="line">                max_attempts = <span class="number">3</span></span><br><span class="line">                attempts = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> attempts &lt; max_attempts:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        function_name = prompt_modified(function_name=function_name, model=<span class="string">&quot;gpt-3.5-turbo-16k-0613&quot;</span>, g=g)</span><br><span class="line">                        <span class="keyword">break</span>  <span class="comment"># 如果代码成功执行，跳出循环</span></span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        attempts += <span class="number">1</span>  <span class="comment"># 增加尝试次数</span></span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;发生错误：&quot;</span>, e)</span><br><span class="line">                        <span class="keyword">if</span> attempts == max_attempts:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&quot;已达到最大尝试次数，程序终止。&quot;</span>)</span><br><span class="line">                            <span class="keyword">raise</span>  <span class="comment"># 重新引发最后一个异常</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&quot;正在重新运行审查程序...&quot;</span>)</span><br><span class="line">                <span class="comment"># 接下来带入进行测试</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;新函数已创建，接下来带入进行测试...&quot;</span>)</span><br><span class="line">                function_test(function_name=function_name, req=req, few_shot=few_shot, g=g)</span><br><span class="line">            <span class="keyword">elif</span> solution == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">                new_req = <span class="built_in">input</span>(<span class="string">&quot;好的，请再次输入用户需求，请注意，用户需求描述方法将极大程度影响最终函数创建结果。&quot;</span>)</span><br><span class="line">                few_shot_str = <span class="built_in">input</span>(<span class="string">&quot;接下来如何运行代码创建函数？1.采用此前Few-shot方案；\n2.使用全部外部函数作为Few-shot&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> few_shot_str == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                    function_name = code_generate(req=new_req, few_shot=few_shot, model=model, g=g)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    function_name = code_generate(req=new_req, few_shot=<span class="string">&#x27;all&#x27;</span>, model=model, g=g)</span><br><span class="line">                function_test(function_name=function_name, req=new_req, few_shot=few_shot, g=g)</span><br><span class="line">            <span class="keyword">elif</span> solution == <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;加油~&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-3-全自动流程代码编写"><a href="#3-2-4-3-全自动流程代码编写" class="headerlink" title="3.2.4.3 全自动流程代码编写"></a>3.2.4.3 全自动流程代码编写</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">req_auto_func</span>(<span class="params">req, few_shot=<span class="string">&#x27;all&#x27;</span>, model=<span class="string">&#x27;glm-4&#x27;</span>, g=<span class="built_in">globals</span>(<span class="params"></span>), detail=<span class="number">0</span></span>):</span><br><span class="line">    function_name = code_generate(req, few_shot=few_shot, model=model, g=g, detail=detail)</span><br><span class="line">    function_test(function_name=function_name, req=req, few_shot=few_shot, model=model, g=g)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-5-大模型编程的瓶颈"><a href="#3-2-5-大模型编程的瓶颈" class="headerlink" title="3.2.5 大模型编程的瓶颈"></a>3.2.5 大模型编程的瓶颈</h3><h4 id="3-2-5-1-编程性能瓶颈的根源"><a href="#3-2-5-1-编程性能瓶颈的根源" class="headerlink" title="3.2.5.1 编程性能瓶颈的根源"></a>3.2.5.1 编程性能瓶颈的根源</h4><p>大模型在复杂问题上的编程能力不足，主要源于缺乏“长期记忆”，无法持续围绕目标生成长代码块。代码编写本质上是按特定格式创作文本，因此大模型在长文本创作能力不足时，长代码编写也会受到限制，导致复杂需求实现的准确性下降。</p>
<h4 id="3-2-5-2-提升长代码编写稳定性的策略"><a href="#3-2-5-2-提升长代码编写稳定性的策略" class="headerlink" title="3.2.5.2 提升长代码编写稳定性的策略"></a>3.2.5.2 提升长代码编写稳定性的策略</h4><p>核心问题在于大模型编写长代码能力不足，而非理解需求能力不足。因此，关键在于提高模型的编程能力，而不是进一步优化提示工程。最直接有效的方法是 “列提纲-分段编写-合并”，通过分段完成提升代码稳定性。需要注意代码衔接、变量一致性以及充分利用已有辅助函数提高开发效率。</p>
<ol>
<li>第一阶段：复杂需求拆解</li>
</ol>
<p>将复杂需求拆解为简单、确定性的子任务，类似CoT（思维链）方式逐步完成。拆分后的子任务需具备明确功能，如“查找邮件”“给邮件打标签”等最小功能单位。为确保拆分准确性，可提供项目背景信息及示例作为Few-shot提示，也可让大模型自行生成拆解示例。子任务需简单易实现，确保代码编写准确性。</p>
<ol start="2">
<li>第二阶段：代码编写与整合</li>
</ol>
<p>完成子任务拆解后，进入代码编写与整合阶段。以下是三种方案：</p>
<p>方案一：高层函数组合</p>
<ul>
<li>思路：创建基础功能函数，编写高层函数整合基础函数输出，完成复杂需求。</li>
<li>优势：便于管理、代码利用率高，可重复使用已有函数。</li>
<li>劣势：大模型难以准确衔接函数输出输入格式，容易导致运行失败。</li>
</ul>
<p>方案二：嵌套函数</p>
<ul>
<li>思路：创建嵌套函数，将子任务函数嵌入主函数内，确保输出输入一致。</li>
<li>优势：减少函数衔接问题，提高代码准确性。</li>
<li>劣势：需多次提示大模型调整代码逻辑，流程复杂，效率较低。</li>
</ul>
<p>方案三：分别创建函数再统一代码（推荐方案）</p>
<ul>
<li>思路：<ol>
<li>拆分子任务，分别创建函数1、函数2，确保单独运行无误。</li>
<li>提供函数1、2源码作为大模型提示，重新编写满足原始需求的完整函数。</li>
</ol>
</li>
<li>优势：<ul>
<li>利用大模型代码生成与自我审查能力，提高复杂需求代码准确性。</li>
<li>函数1、2无需完美衔接，最终函数参考其代码逻辑重新生成完整实现。</li>
<li>高度复用已有函数生成与测试流程，开发效率显著提升。</li>
</ul>
</li>
</ul>
<h3 id="3-2-6复杂任务的编程落地"><a href="#3-2-6复杂任务的编程落地" class="headerlink" title="3.2.6复杂任务的编程落地"></a>3.2.6复杂任务的编程落地</h3><h4 id="3-2-6-1-复杂需求拆解"><a href="#3-2-6-1-复杂需求拆解" class="headerlink" title="3.2.6.1 复杂需求拆解"></a>3.2.6.1 复杂需求拆解</h4><p>&emsp;&emsp;首先，我们需要创建一个专门用于复杂问题拆解的模型。根据此前的分析，该模型同时需要外部挂载文档以说明项目背景和复杂任务拆解的目的，同时还需要一些复杂任务拆解的示例作为Few-shot。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./data/复杂任务拆解.md&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    md_content_plus = f.read()</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(md_content_plus)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是邮箱项目？邮件项目本身由一系列的程序组成，核心功能是根据用户自然语言描述进行相应的邮箱操作，如查阅邮件、收发邮件等。该场景是我们自己构建的一个场景。</span><br><span class="line">主要实现的是对我们my_mail数据库里的数据进行增删查改。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>什么是任务拆解？在邮箱项目中，任务拆解指的是将用户需求拆解为若干个最小子任务的过程，任务拆解的目标是为了降低完成复杂任务的难度。例如以下就是一个复杂任务拆解过程，原始用户需求为Q：“请帮我查下西门吹雪给我发送了哪些邮件，并对这些邮件内容进行总结”，该需求可以拆分为两个最小子任务，分别是A:“<span class="number">1.</span>查找我和西门吹雪之间通信的邮件列表”，“<span class="number">2.</span>根据某份邮件列表，对这些邮件的主要内容进行总结”；</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>什么是最小子任务？最小子任务指的是在在邮箱项目中，在进行复杂任务拆解时拆解得到的最小任务单元。例如获取我和西门吹雪之间的通信列表、围绕某些邮件进行内容总结，就属于最小子任务。最小子任务不可再进行任务拆解，并且最小子任务往往都是较为简单的任务，是一些可以快速的实现的功能；</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>若一个任务拆解成了多个最小子任务，那么请注意这多个最小子任务的任务顺序，例如此前的例子中，查找邮件列表就应该发生在对邮件内容进行总结之前。</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>你是一名任务拆解助手，负责邮件项目中用户需求拆解。当一个用户需求可以拆解为多个最小子任务时，请对其进行最小子任务的拆解；而当一个用户需求本身就是一个最小子任务时，则无需对其进行拆解。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;接下来继续创建Few-shot的提示示例。这里总共编写了四组难度和复杂度各不相同的四个需求进行拆解，具体提示示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">example1_user = <span class="string">&#x27;Q:请帮我查下西门吹雪给我发送了哪些邮件，并对这些邮件内容进行总结。&#x27;</span></span><br><span class="line">example1_assistent = <span class="string">&#x27;A:1.请帮我整理西门吹雪发给我的邮件列表。2.对某些给定的邮件进行邮件内容总结。&#x27;</span></span><br><span class="line"></span><br><span class="line">example2_user = <span class="string">&#x27;Q:请帮我查下最近一封未读邮件的发件人。&#x27;</span></span><br><span class="line">example2_assistent = <span class="string">&#x27;A:1.请帮我查下最近一封未读邮件的发件人。&#x27;</span></span><br><span class="line"></span><br><span class="line">example3_user = <span class="string">&#x27;Q:请分析我邮箱里全部已收到的邮件，告诉我最常联系的人。&#x27;</span></span><br><span class="line">example3_assistent = <span class="string">&#x27;A:1.请帮我整理邮箱里全部已收到邮件的邮件列表。2.根据某份邮件列表，分析并找出最常联系的人。&#x27;</span></span><br><span class="line"></span><br><span class="line">example4_user = <span class="string">&#x27;Q:请在我邮箱里查找6月5号到6号的未读邮件，并找出工作相关的未读邮件，请依次给这些未读邮件回复说我正在休假，同时请将这些邮件转发给我的助理西门吹雪。&#x27;</span></span><br><span class="line">example4_assistent = <span class="string">&#x27;A:1.请查找并整理我邮箱里6月5号到6号的未读邮件列表。2.根据某份邮件列表，查找并汇总其中和工作有关的列表。3.根据某份邮件列表，对其逐一进行回复，告诉他们我正在休假。4.根据某份邮件列表，将其逐一转发给我的助理西门吹雪。&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是，这里我们统一通过Q&amp;A的方式来提示模型不同内容的类型，同时拆解之后的每段文字也都以句号结尾，方便后续进行结构化字符串提取。在创建的四个提示实力中，1、3示例属于一般示例，对于大多数复杂需求来说，拆解为两个子任务基本就基本能够构成较好的自然语言编程引导，而第二个提示示例则是提醒模型，当需求较为简单时，不用进行需求拆解；而最后一个提示的示例，则是一个相对来说非常复杂的需求，总共拆解得到了4个子任务，是为了提醒模型在必要时，可以多拆分一些子任务。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">req = <span class="string">&#x27;请查阅我邮箱里面未读邮件，从挑选有公司的邮件，并将其标签改为紧急&#x27;</span></span><br><span class="line">system_message = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: md_content_plus&#125;]</span><br><span class="line">decomp_few_shot = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: example1_user&#125;,</span><br><span class="line">                   &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: example1_assistent&#125;, </span><br><span class="line">                   &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: example2_user&#125;, </span><br><span class="line">                   &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: example2_assistent&#125;, </span><br><span class="line">                   &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: example3_user&#125;, </span><br><span class="line">                   &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: example3_assistent&#125;, </span><br><span class="line">                   &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: example4_user&#125;, </span><br><span class="line">                   &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: example4_assistent&#125;]</span><br><span class="line">messages = system_message + decomp_few_shot</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/%s.json&#x27;</span> % <span class="string">&#x27;decompose_messages&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(messages, f)</span><br><span class="line">    </span><br><span class="line">messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: req&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sub_req1 = <span class="string">&#x27;查阅邮箱中的未读邮件，并整理出未读邮件列表。&#x27;</span></span><br><span class="line">sub_req2 = <span class="string">&#x27;从未读邮件列表中筛选出包含公司信息的邮件。&#x27;</span></span><br><span class="line">sub_req3 = <span class="string">&#x27;对于筛选出的公司邮件，将其标签改为“紧急”。&#x27;</span></span><br></pre></td></tr></table></figure>

<p>至此，我们就完成了原始任务的拆解部分工作。当然，我们也可以将上述过程封装为一个完整的函数，方便之后进行灵活调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_decompose_results</span>(<span class="params">req, model=<span class="string">&#x27;glm-4&#x27;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    复杂需求拆解函数，能够将用户输入的复杂需求拆解为一系列更容易完成的子任务</span></span><br><span class="line"><span class="string">    :param req: 必选参数，以字符串形式表示，用于表示用户输入的原始需求；</span></span><br><span class="line"><span class="string">    :param model: 拆解需求所使用的大模型；</span></span><br><span class="line"><span class="string">    :return：由子任务所组成的列表；</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    decompose_results = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/decompose_messages.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        decompose_messages = json.load(f)</span><br><span class="line">        </span><br><span class="line">    decompose_messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: req&#125;)</span><br><span class="line">    </span><br><span class="line">    response = client.chat.completions.create(</span><br><span class="line">                model=model,</span><br><span class="line">                messages=decompose_messages</span><br><span class="line">            )</span><br><span class="line">    </span><br><span class="line">    res = response.choices[<span class="number">0</span>].message.content</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用正则表达式查找以1、2、3开始的句子</span></span><br><span class="line">    matches = re.findall(<span class="string">r&#x27;\d\.(.*?。)&#x27;</span>, res)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">        decompose_results.append(<span class="keyword">match</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> decompose_results</span><br></pre></td></tr></table></figure>

<h4 id="3-2-6-2-代码编写与整合"><a href="#3-2-6-2-代码编写与整合" class="headerlink" title="3.2.6.2 代码编写与整合"></a>3.2.6.2 代码编写与整合</h4><p>方案三：分别创建函数再统一代码（推荐方案）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">func1_name = code_generate(sub_req1, few_shot=<span class="string">&#x27;all&#x27;</span>, g=<span class="built_in">globals</span>(), detail=<span class="number">1</span>)</span><br><span class="line">func2_name = code_generate(sub_req2, few_shot=<span class="string">&#x27;all&#x27;</span>, g=<span class="built_in">globals</span>(), detail=<span class="number">1</span>)</span><br><span class="line">func3_name = code_generate(sub_req3, few_shot=<span class="string">&#x27;all&#x27;</span>, g=<span class="built_in">globals</span>(), detail=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_module.py&#x27;</span> % (func1_name, func1_name), encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    func1_str = f.read()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_module.py&#x27;</span> % (func2_name, func2_name), encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    func2_str = f.read()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_module.py&#x27;</span> % (func3_name, func3_name), encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    func3_str = f.read()</span><br><span class="line"></span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">  model=<span class="string">&#x27;glm-4&#x27;</span>,</span><br><span class="line">  messages=[</span><br><span class="line">      &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&#x27;以下是函数1的代码：%s&#x27;</span> % func1_str&#125;,</span><br><span class="line">      &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&#x27;以下是函数2的代码：%s&#x27;</span> % func2_str&#125;,</span><br><span class="line">      &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&#x27;以下是函数3的代码：%s&#x27;</span> % func3_str&#125;,</span><br><span class="line">      &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&#x27;请将函数1、函数2和函数3的代码功能整合到一个函数中，要求该函数功能完整，并且可以满足以下需求：%s&#x27;</span> % req&#125;</span><br><span class="line">  ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">req_auto_func</span>(<span class="params">req, few_shot=<span class="string">&#x27;all&#x27;</span>, model=<span class="string">&#x27;glm-4&#x27;</span>, g=<span class="built_in">globals</span>(<span class="params"></span>), detail=<span class="number">0</span></span>):</span><br><span class="line">    <span class="comment"># 默认情况下system_messages = None</span></span><br><span class="line">    system_messages = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试进行任务拆解</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        decompose_results = get_decompose_results(req=req, model=model)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;代码能执行到这儿吗？&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;暂停1分钟后继续调用模型&#x27;</span>)</span><br><span class="line">        <span class="comment">#time.sleep(60)</span></span><br><span class="line">        decompose_results = get_decompose_results(req=req, model=model)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 如果只拆解得到多个任务，则创建新的基于任务拆解得到的system_message</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(decompose_results) != <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;原始需求将拆分为多个子需求并进行分段代码创建与合并&#x27;</span>)</span><br><span class="line">        <span class="comment"># 读取原始system_message</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/tested functions/system_messages.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            system_messages = json.load(f)</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 用于存储全部需求的函数代码</span></span><br><span class="line">        sub_func_all = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># 用于存储全部需求</span></span><br><span class="line">        sub_req_all = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># 计数器</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> sub_req <span class="keyword">in</span> decompose_results:</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            <span class="comment"># 每个需求依次创建子函数</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;第%s个子需求为：%s&#x27;</span> % (i, sub_req))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;正在创建对应子函数&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                sub_func_name = code_generate(sub_req, few_shot=few_shot, g=g, detail=detail, model=model)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(e)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;暂停1分钟后继续调用模型&#x27;</span>)</span><br><span class="line">                time.sleep(<span class="number">60</span>)</span><br><span class="line">                sub_func_name = code_generate(sub_req, few_shot=few_shot, g=g, detail=detail, model=model)</span><br><span class="line">                </span><br><span class="line">            <span class="comment"># 读取子函数源码</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./functions/untested functions/%s/%s_module.py&#x27;</span> % (sub_func_name, sub_func_name), encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                sub_func_str = f.read()</span><br><span class="line">            <span class="comment"># 对子函数源码进行拼接</span></span><br><span class="line">            sub_func_all += sub_func_str</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 按顺序拼接子需求</span></span><br><span class="line">            sub_req_all += <span class="built_in">str</span>(i)+(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">            sub_req_all += sub_req            </span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;子需求对应的子函数全部创建完毕，接下来进入到原始需求函数创建过程...&#x27;</span>)</span><br><span class="line">        <span class="comment"># 添加一个system_message</span></span><br><span class="line">        decompose_description = <span class="string">&#x27;对于当前编程需求，可以拆解为若干个子需求，也就是：%s。这些子需求的实现方式可以参考如下代码：%s&#x27;</span> % (sub_req_all, sub_func_all)</span><br><span class="line">        system_messages[<span class="string">&#x27;system_message&#x27;</span>].append(&#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: decompose_description&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 进行代码创建和代码审查</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        function_name = code_generate(req=req, few_shot=few_shot, model=model, g=g, detail=detail, system_messages=system_messages)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;暂停1分钟后继续调用模型&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">60</span>)</span><br><span class="line">        function_name = code_generate(req=req, few_shot=few_shot, model=model, g=g, detail=detail, system_messages=system_messages)</span><br><span class="line">        </span><br><span class="line">    function_test(function_name=function_name, req=req, few_shot=few_shot, model=model, g=g, system_messages=system_messages)</span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/tags/">标签</a></li>
        
          <li><a href="/categories/">分类</a></li>
        
          <li><a href="/search/">搜索</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/hughnwj">项目</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%9D%A2%E5%90%91%E7%9B%AE%E6%A0%87%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">1. 面向目标架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E9%9D%A2%E5%90%91%E7%9B%AE%E6%A0%87%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 面向目标开发流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 技术选型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E4%B8%8E%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 提示词工程与外部函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-AGENT-%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 AGENT 设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-RAG-%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 RAG 设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-%E5%BE%AE%E8%B0%83-Fine-tuning"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 微调 (Fine-tuning)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-%E9%A2%84%E8%AE%AD%E7%BB%83-Pre-training"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5 预训练 (Pre-training)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Function-Call-%E8%BF%9B%E9%98%B6"><span class="toc-number">2.</span> <span class="toc-text">2. Function Call 进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B%E5%9B%9E%E9%A1%BE"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 外部函数调用流程回顾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%9B%9B%E5%A4%A7%E6%8C%91%E6%88%98"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 四大挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%84%8F%E5%9B%BE%E8%AF%86%E5%88%AB"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 意图识别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-1-%E8%AF%AF%E5%88%A4%EF%BC%9A%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">2.2.1.1 误判：是否需要外部函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-2-%E8%AF%AF%E9%80%89%EF%BC%9A%E7%9B%B8%E4%BC%BC%E5%87%BD%E6%95%B0%E5%90%8D%E7%A7%B0%E6%B7%B7%E6%B7%86"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">2.2.1.2 误选：相似函数名称混淆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-3-%E7%BB%93%E6%9E%9C%E6%95%B4%E5%90%88%E5%A4%B1%E8%B4%A5%EF%BC%88%E5%8D%B3%E4%BD%BF%E8%B0%83%E7%94%A8%E6%88%90%E5%8A%9F%EF%BC%8C%E7%BB%93%E6%9E%9C%E4%BB%8D%E7%84%B6%E6%9C%89%E8%AF%AF%EF%BC%89"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">2.2.1.3 结果整合失败（即使调用成功，结果仍然有误）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%B5%B7%E9%87%8F%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 海量函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-1-%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">2.2.2.1 优化策略</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E5%B9%B6%E5%8F%91%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 并发调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-1-%E4%B8%B2%E8%A1%8C%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">2.2.3.1 串行调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-2-%E5%B9%B6%E8%A1%8C%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">2.2.3.2 并行调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-%E5%93%8D%E5%BA%94%E5%A4%AA%E6%85%A2"><span class="toc-number">2.2.4.</span> <span class="toc-text">2.2.4 响应太慢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-1-%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">2.2.4.1 缓存设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-2-%E5%8A%A8%E6%80%81%E8%B0%83%E6%95%B4%E8%B0%83%E7%94%A8%E9%80%BB%E8%BE%91"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">2.2.4.2 动态调整调用逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-3-%E5%BB%B6%E8%BF%9F%E5%8F%8D%E9%A6%88"><span class="toc-number">2.2.4.3.</span> <span class="toc-text">2.2.4.3 延迟反馈</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E9%9D%A2%E5%90%91%E7%9B%AE%E6%A0%87%E6%9E%B6%E6%9E%84%E9%98%B6%E6%AE%B5"><span class="toc-number">3.</span> <span class="toc-text">3. 面向目标架构阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BB%A5%E4%BA%BA%E4%B8%BA%E4%B8%BB%EF%BC%8CAI%E4%B8%BA%E8%BE%85"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 以人为主，AI为辅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A1%88%E4%BE%8B%EF%BC%9A"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 提示词案例：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Al%E5%92%8C%E4%BA%BA%E7%9B%B8%E4%BA%92%E9%85%8D%E5%90%88"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Al和人相互配合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%80%9F%E5%8A%A9Few-Shot"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 借助Few-Shot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E5%80%9F%E5%8A%A9LtM"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 借助LtM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3%E5%85%A8%E8%87%AA%E5%8A%A8%E5%8A%9F%E8%83%BD%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3全自动功能函数编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-1-%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%AE%A1%E7%90%86"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">3.2.3.1 提示词管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-2-code-generate%E5%85%A8%E8%87%AA%E5%8A%A8%E7%BC%96%E7%A8%8B%E5%87%BD%E6%95%B0%E5%88%9B%E5%BB%BA%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">3.2.3.2 code_generate全自动编程函数创建方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-3-%E9%A2%9D%E5%A4%96%E9%9C%80%E6%B1%82%E6%B5%8B%E8%AF%95"><span class="toc-number">3.2.3.3.</span> <span class="toc-text">3.2.3.3 额外需求测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Al%E4%B8%BA%E4%B8%BB%EF%BC%8C%E4%BB%A5%E4%BA%BA%E4%B8%BA%E8%BE%85"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Al为主，以人为辅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E5%AE%A1%E6%9F%A5%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%96%B9%E6%A1%88%E5%89%96%E6%9E%90"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 审查模型构建方案剖析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E5%AE%A1%E6%9F%A5%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%96%B9%E6%A1%88%E8%90%BD%E5%9C%B0"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 审查模型构建方案落地</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E5%AE%A1%E6%9F%A5%E6%A8%A1%E5%9E%8B%E6%95%88%E6%9E%9C%E9%AA%8C%E8%AF%81"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3 审查模型效果验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-4-%E5%9F%BA%E4%BA%8E%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%87%AA%E5%8A%A8Debug%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.4.</span> <span class="toc-text">3.3.4 基于大模型的自动Debug的函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-1-%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%AE%A1%E6%9F%A5%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">3.3.4.1 定义一个审查函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-2-%E6%9E%84%E5%BB%BA%E8%87%AA%E5%8A%A8Debug%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">3.3.4.2 构建自动Debug的函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-3-%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%81%E7%A8%8B%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99"><span class="toc-number">3.3.4.3.</span> <span class="toc-text">3.2.4.3 全自动流程代码编写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%BC%96%E7%A8%8B%E7%9A%84%E7%93%B6%E9%A2%88"><span class="toc-number">3.3.5.</span> <span class="toc-text">3.2.5 大模型编程的瓶颈</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-1-%E7%BC%96%E7%A8%8B%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E7%9A%84%E6%A0%B9%E6%BA%90"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">3.2.5.1 编程性能瓶颈的根源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-2-%E6%8F%90%E5%8D%87%E9%95%BF%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E7%A8%B3%E5%AE%9A%E6%80%A7%E7%9A%84%E7%AD%96%E7%95%A5"><span class="toc-number">3.3.5.2.</span> <span class="toc-text">3.2.5.2 提升长代码编写稳定性的策略</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-6%E5%A4%8D%E6%9D%82%E4%BB%BB%E5%8A%A1%E7%9A%84%E7%BC%96%E7%A8%8B%E8%90%BD%E5%9C%B0"><span class="toc-number">3.3.6.</span> <span class="toc-text">3.2.6复杂任务的编程落地</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-6-1-%E5%A4%8D%E6%9D%82%E9%9C%80%E6%B1%82%E6%8B%86%E8%A7%A3"><span class="toc-number">3.3.6.1.</span> <span class="toc-text">3.2.6.1 复杂需求拆解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-6-2-%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E4%B8%8E%E6%95%B4%E5%90%88"><span class="toc-number">3.3.6.2.</span> <span class="toc-text">3.2.6.2 代码编写与整合</span></a></li></ol></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&text=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&is_video=false&description=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=4.Agent实战基础之提示词工程和Function进阶实战&body=Check out this article: http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&title=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&name=4.Agent实战基础之提示词工程和Function进阶实战&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/03/17/4.Agent%E5%AE%9E%E6%88%98%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%92%8CFunction%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/&t=4.Agent实战基础之提示词工程和Function进阶实战"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    cozy
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/hughnwj">项目</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
